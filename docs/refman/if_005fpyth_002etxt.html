<!DOCTYPE html>
<html lang="ja">
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>

<title>if_pyth.txt (Vim Reference Manual)</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<meta name="description" content="if_pyth.txt (Vim Reference Manual)">
<meta name="keywords" content="if_pyth.txt (Vim Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<link href="Mu-Ci-.html" rel="start" title="目次">
<link href="Indexes-CP.html" rel="index" title="Indexes CP">
<link href="Mu-Ci-.html" rel="up" title="目次">
<link href="if_005ftcl_002etxt.html" rel="next" title="if_tcl.txt">
<link href="if_005fperl_002etxt.html" rel="prev" title="if_perl.txt">
<style>
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="style.css">


</head>

<body lang="ja">
<span id="if_005fpyth_002etxt"></span><div class="header">
<p>
Up: <a href="Mu-Ci-.html" accesskey="u" rel="up">目次</a> &nbsp; [<a href="Indexes-CP.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Python-intahueisu"></span><h2 class="unnumbered">Python インターフェイス</h2>
<pre class="verbatim">*if_pyth.txt*   For Vim バージョン 8.1.  Last change: 2019 Jul 21


                  VIMリファレンスマニュアル    by Paul Moore
</pre>

<span id="python"></span><span id="Python"></span><span id="index-python"></span>
<span id="index-Python"></span>
<p>Vim の Python インターフェイス
</p>
<table>
<tr><td width="50%">1. コマンド</td><td width="50%">|<a href="#python_002dcommands">python-commands</a>|</td></tr>
<tr><td width="50%">2. vim モジュール</td><td width="50%">|<a href="#python_002dvim">python-vim</a>|</td></tr>
<tr><td width="50%">3. バッファオブジェクト</td><td width="50%">|<a href="#python_002dbuffer">python-buffer</a>|</td></tr>
<tr><td width="50%">4. レンジオブジェクト</td><td width="50%">|<a href="#python_002drange">python-range</a>|</td></tr>
<tr><td width="50%">5. ウィンドウオブジェクト</td><td width="50%">|<a href="#python_002dwindow">python-window</a>|</td></tr>
<tr><td width="50%">6. タブページオブジェクト</td><td width="50%">|<a href="#python_002dtabpage">python-tabpage</a>|</td></tr>
<tr><td width="50%">7. vim.bindeval オブジェクト</td><td width="50%">|<a href="#python_002dbindeval_002dobjects">python-bindeval-objects</a>|</td></tr>
<tr><td width="50%">8. Vim 函數 pyeval() と py3eval()</td><td width="50%">|<a href="#python_002dpyeval">python-pyeval</a>|</td></tr>
<tr><td width="50%">9. 動的ローディング</td><td width="50%">|<a href="#python_002ddynamic">python-dynamic</a>|</td></tr>
<tr><td width="50%">10. Python 3</td><td width="50%">|<a href="#python3">python3</a>|</td></tr>
<tr><td width="50%">11. Python X</td><td width="50%">|<a href="#python_005fx">python_x</a>|</td></tr>
<tr><td width="50%">12. Python 對應付きでビルドする</td><td width="50%">|<a href="#python_002dbuilding">python-building</a>|</td></tr>
</table>

<p>Python 2.x インターフェイスは Vim が |<a href="various_002etxt.html#g_t_002bpython">+python</a>| 機能付きでコンパイルされたときのみ利用できます。
</p>
<p>Python 3 インターフェイスは Vim が |<a href="various_002etxt.html#g_t_002bpython3">+python3</a>| 機能付きでコンパイルされたときのみ利用できます。
</p>
<p>兩方を同時に利用することはできますが、|<a href="#python_002d2_002dand_002d3">python-2-and-3</a>| をお讀みください。
</p>
<span id="python_002dcommands"></span><span id="index-python_002dcommands"></span>
<span id="g_t1_002e-komando-2"></span><h3 class="section">1. コマンド</h3>

<span id="g_t_003apython"></span><span id="g_t_003apy"></span><span id="E263"></span><span id="E264"></span><span id="E887"></span><span id="index-_003apython"></span>
<span id="index-_003apy"></span>
<span id="index-E263"></span>
<span id="index-E264"></span>
<span id="index-E887"></span>
<dl compact="compact">
<dt>:[range]py[thon] {stmt}</dt>
<dd><p>Python のステートメント {stmt} を實行します。&lsquo;<code>:python</code>&lsquo; コマンドが機能するか簡單にチェックするには:
</p><pre class="verbatim">:python print &quot;Hello&quot;
</pre>
</dd>
<dt>:[range]py[thon] &lt;&lt; [endmarker]</dt>
<dt>{script}</dt>
<dt>{endmarker}</dt>
<dd><p>Python のスクリプト {script} を實行します。
</p><blockquote>
<p><strong>Note:</strong> <br>
このコマンドは Python 用の機能を含めてコンパイルされてゐないときは機能しません。エラーを抑制するには |<a href="if_005fperl_002etxt.html#script_002dhere">script-here</a>| を參照してください。
</p></blockquote>
</dd>
</dl>

<p>{script} 以降の {endmarker} の前に空白を置かないでください。
</p>
<p>&quot;&lt;&lt;&quot; の後に [endmarker] を省略した時は |<a href="insert_002etxt.html#g_t_003aappend">:append</a>| や |<a href="insert_002etxt.html#g_t_003ainsert">:insert</a>| のやうに &rsquo;.&rsquo; は {script} の後に使はれなければなりません。
</p>
<p>この形の |<a href="#g_t_003apython">:python</a>| コマンドは Vim script に Python コードを埋め込むのに特に便利です。
</p>
<p>例:
</p><pre class="verbatim">function! IcecreamInitialize()
python &lt;&lt; EOF
class StrawberryIcecreame:
        def __call__(self):
                print 'EAT ME'
EOF
endfunction
</pre>
<p>使つてゐる Python のバージョンを見るには:
</p><pre class="verbatim">:python print(sys.version)
</pre>
<p>sys をインポートする必要はない。これはデフォルトで行はれる。
</p>
<blockquote>
<p><strong>Note:</strong> <br>
Python はインデントに關して非常に繊細です。&quot;class&quot; の行と &quot;EOF&quot; の行はまつたくインデントしないでください。
</p></blockquote>

<dl compact="compact">
<dd><span id="g_t_003apydo"></span><span id="index-_003apydo"></span>
</dd>
<dt>:[range]pydo {body}</dt>
<dd><p>Python の式を &quot;def _vim_pydo(line linenr): {body}&quot; といふ形で實行します。引數には各行のテキスト (末尾の &lt;EOL&gt; なし) と行番號が渡されます。函數は文字列か None を返さなければなりません。文字列を返すと行がその文字列で置換されます。[range] を指定しなかつた場合は &quot;1,$&quot; (ファイル全體) が範圍となります。
</p>
<p>例:
</p><pre class="verbatim">:pydo return &quot;%s\t%d&quot; % (line[::-1], len(line))
:pydo if line: return &quot;%4d: %s&quot; % (linenr, line)
</pre><p>ひとつに、Python を用ゐて範圍をフィルターするために、&lsquo;:py&lsquo; と連動して &lsquo;:pydo&lsquo; を使ふことができます。例へば:
</p>
<pre class="verbatim">:py3 &lt;&lt; EOF
needle = vim.eval('@a')
replacement = vim.eval('@b')

def py_vim_string_replace(str):
        return str.replace(needle, replacement)
EOF
:'&lt;,'&gt;py3do return py_vim_string_replace(line)
</pre><span id="g_t_003apyfile"></span><span id="g_t_003apyf"></span><span id="index-_003apyfile"></span>
<span id="index-_003apyf"></span>
</dd>
<dt>:[range]pyf[ile] {file}</dt>
<dd><p>{file} 內の Python スクリプトを實行します。引數はそのまま 1 つのファイル名として使はれます。
</p></dd>
</dl>

<p>これら 2 つのコマンドは、本質的には同じことを行ひます - つまり、Python のコードを、與へられた &quot;現在の範圍&quot; |<a href="#python_002drange">python-range</a>| に對して實行します。
</p>
<p>:python の場合には、實行されるコードはコマンドラインで與へられたものです。
</p>
<p>:pyfile の場合には、實行されるコードは與へられたファイルの中身です。
</p>
<p>Python のコマンドは |<a href="eval_002etxt.html#sandbox">sandbox</a>| の中では使へません。
</p>
<p>引數を渡すためには明示的に sys.argv[] を使つて設定してください。例:
</p><pre class="verbatim">:python sys.argv = [&quot;foo&quot;, &quot;bar&quot;]
:pyfile myscript.py
</pre>
<span id="python_002dexamples"></span><span id="index-python_002dexamples"></span>
<p>いくつか例を擧げます
</p><pre class="verbatim">:python from vim import *
:python from string import upper
:python current.line = upper(current.line)
:python print &quot;Hello&quot;
:python str = current.buffer[42]
</pre>
<blockquote>
<p><strong>Note:</strong> <br>
變更 - importsなど - は、Python インタープリターと同樣に、次のコマンドに引き繼がれます。
</p></blockquote>

<span id="python_002dvim"></span><span id="index-python_002dvim"></span>
<span id="g_t2_002e-vim-moziyuru-1"></span><h3 class="section">2. vim モジュール</h3>

<p>Python コードは、vim モジュールを通して、vim に自由にアクセスすることができます (ただひとつの例外を除いて - 以下の |<a href="#python_002doutput">python-output</a>| を參照)。vim モジュールは 2 つのメソッド、3 つの定數、そして 1 つのエラーオブジェクトを實裝してゐます。これを使ふには vim モジュールを import する必要があります。
</p><pre class="verbatim">:python import vim
</pre>
<p>槪要
</p><table>
<tr><td width="60%">:py print &quot;Hello&quot;</td><td width="40%">メッセージを表示</td></tr>
<tr><td width="60%">:py vim.command(cmd)</td><td width="40%">ex コマンドを實行</td></tr>
<tr><td width="60%">:py w = vim.windows[n]</td><td width="40%">ウィンドウ &quot;n&quot; を得る</td></tr>
<tr><td width="60%">:py cw = vim.current.window</td><td width="40%">現在のウィンドウを得る</td></tr>
<tr><td width="60%">:py b = vim.buffers[n]</td><td width="40%">バッファ &quot;n&quot; を得る</td></tr>
<tr><td width="60%">:py cb = vim.current.buffer</td><td width="40%">現在のバッファを得る</td></tr>
<tr><td width="60%">:py w.height = lines</td><td width="40%">ウィンドウの高さを設定する</td></tr>
<tr><td width="60%">:py w.cursor = (row, col)</td><td width="40%">ウィンドウのカーソル位置を設定する</td></tr>
<tr><td width="60%">:py pos = w.cursor</td><td width="40%">(row, col) の組を得る</td></tr>
<tr><td width="60%">:py name = b.name</td><td width="40%">バッファのファイル名を得る</td></tr>
<tr><td width="60%">:py line = b[n]</td><td width="40%">バッファから 1 行を得る</td></tr>
<tr><td width="60%">:py lines = b[n:m]</td><td width="40%">バッファから一聯の行を得る</td></tr>
<tr><td width="60%">:py num = len(b)</td><td width="40%">行數を得る</td></tr>
<tr><td width="60%">:py b[n] = str</td><td width="40%">バッファ內の 1 行を設定する</td></tr>
<tr><td width="60%">:py b[n:m] = [str1, str2, str3]</td><td width="40%">1 度に數行を設定する</td></tr>
<tr><td width="60%">:py del b[n]</td><td width="40%">1 行を削除する</td></tr>
<tr><td width="60%">:py del b[n:m]</td><td width="40%">數行を削除する</td></tr>
</table>


<span id="g_t_0022vim_0022-moziyurunomesotudo"></span><h4 class="unnumberedsubsec">&quot;vim&quot; モジュールのメソッド</h4>

<dl compact="compact">
<dd><span id="python_002dcommand"></span><span id="index-python_002dcommand"></span>
</dd>
<dt>vim.command(str)</dt>
<dd><p>vim (ex モード) のコマンド str を實行します。戾り値はありません。
</p>
<p>例:
</p><pre class="verbatim">:py vim.command(&quot;set tw=72&quot;)
:py vim.command(&quot;%s/aaa/bbb/g&quot;)
</pre><p>ノーマルモードのコマンドを實行するには、次の定義が使はれます:
</p><pre class="verbatim">def normal(str):
        vim.command(&quot;normal &quot;+str)
# '...' は、二重引用符を含む文字列の境界に使はれることに注意
normal('&quot;a2dd&quot;aP')
</pre><span id="E659"></span><span id="index-E659"></span>
<p>&quot;<code>:python</code>&quot; コマンドは、Python 2.2 かそれより古いものでは再歸的に使へません。Python 2.3 かそれより新しいものを使つてください。
</p><pre class="verbatim">:py vim.command(&quot;python print 'Hello again Python'&quot;)
</pre>
<span id="python_002deval"></span><span id="index-python_002deval"></span>
</dd>
<dt>vim.eval(str)</dt>
<dd><p>vim 內の式評價を使つて、式を評價します (|<a href="eval_002etxt.html#expression">expression</a>| を參照)。戾り値は、次の通り:
</p><ul>
<li> Vim の式を評價した結果が文字列か數値ならば文字列
</li><li> Vim の式を評價した結果がリストならばリスト
</li><li> Vim の式を評價した結果が Vim の辭書ならば辭書
</li></ul>
<p>辭書とリストは再歸的に展開されます。
</p>
<p>例:
</p><pre class="verbatim">:&quot; 'textwidth' オプションの値
:py text_width = vim.eval(&quot;&amp;tw&quot;)
:
:&quot; 'a' レジスタの內容
:py a_reg = vim.eval(&quot;@a&quot;) 
:
:&quot; 結果は文字列！數値に變換するために string.atoi() を使ひます。
:py str = vim.eval(&quot;12+12&quot;)
:
:py tagList = vim.eval('taglist(&quot;eval_expr&quot;)')
</pre><p>最後のコマンドは Python 辭書の Python リストを返します。
</p>
<p>例:
</p><pre class="verbatim">[{'cmd': '/^eval_expr(arg, nextcmd)$/', 'static': 0, 'name':
'eval_expr', 'kind': 'f', 'filename': './src/eval.c'}]
</pre>
<span id="python_002dbindeval"></span><span id="index-python_002dbindeval"></span>
</dd>
<dt>vim.bindeval(str)</dt>
<dd><p>|<a href="#python_002deval">python-eval</a>| と似てゐますが、特殊なオブジェクトを返します (|<a href="#python_002dbindeval_002dobjects">python-bindeval-objects</a>| 參照)。これを使ふと Vim のリスト (|<a href="eval_002etxt.html#List">List</a>|) や辭書 (|<a href="eval_002etxt.html#Dictionary">Dictionary</a>|) を變更したり、Vim の函數 (|<a href="eval_002etxt.html#Funcref">Funcref</a>|) を呼び出したりできます。
</p>
<span id="python_002dstrwidth"></span><span id="index-python_002dstrwidth"></span>
</dd>
<dt>vim.strwidth(str)</dt>
<dd><p>|<a href="eval_002etxt.html#strwidth_0028_0029">strwidth()</a>| と同じ。str の畫面上の幅を數値で返す。タブ文字は 1 幅としてカウントされる。
</p>
<span id="python_002dforeach_005frtp"></span><span id="index-python_002dforeach_005frtp"></span>
</dd>
<dt>vim.foreach_rtp(callable)</dt>
<dd><p>&rsquo;<samp>runtimepath</samp>&rsquo; の各パスについてコーラブル (callable) を呼び出す。コーラブルが None 以外の値を返すか、例外が發生するか、パスの最後まで處理が進むと停止する。コーラブルが None 以外の値を返して停止した場合は、vim.foreach_rtp 函數はその値を返す。
</p>
<span id="python_002dchdir"></span><span id="index-python_002dchdir"></span>
</dd>
<dt>vim.chdir(*args, **kwargs)</dt>
<dd><span id="python_002dfchdir"></span><span id="index-python_002dfchdir"></span>
</dd>
<dt>vim.fchdir(*args, **kwargs)</dt>
<dd><p>os.chdir、os.fchdir を實行し、Vim にそのことを通知する。
</p><blockquote>
<p><strong>Note:</strong> <br>
これらの函數は直接は使用しない。代はりに os.chdir と os.fchdir を使ふ。os.fchdir が存在しない場合の vim.fchdir の動作は未定義。
</p></blockquote>
</dd>
</dl>

<span id="g_t_0022vim_0022-moziyurunoeraobuziekuto"></span><h4 class="unnumberedsubsec">&quot;vim&quot; モジュールのエラーオブジェクト</h4>

<dl compact="compact">
<dd><span id="python_002derror"></span><span id="index-python_002derror"></span>
</dd>
<dt>vim.error</dt>
<dd><p>vim のエラーに遭遇したとき、Python は型 vim.error の例外を發生させます。
</p>
<p>例:
</p><pre class="verbatim">try:
        vim.command(&quot;put a&quot;)
except vim.error:
        # レジスタaが空
</pre></dd>
</dl>

<span id="moziyuru-_0022vim_0022-noDing-Shu-"></span><h4 class="unnumberedsubsec">モジュール &quot;vim&quot; の定數</h4>

<blockquote>
<p><strong>Note:</strong> <br>
モジュール &quot;vim&quot; の定數は、實際には定數ではありません。よつて代入し直すことができます。しかし、それは馬鹿げたことです。その變數が參照してゐる vim オブジェクトへのアクセスができなくなつてしまふからです。
</p></blockquote>

<dl compact="compact">
<dd><span id="python_002dbuffers"></span><span id="index-python_002dbuffers"></span>
</dd>
<dt>vim.buffers</dt>
<dd><p>一聯の vim バッファへのアクセスを提供するマッピングオブジェクト。次の操作がサポートされてゐます:
</p><table>
<tr><td width="60%">:py b = vim.buffers[i]</td><td width="40%">インデックス化する (讀取り專用)</td></tr>
<tr><td width="60%">:py b in vim.buffers</td><td width="40%">メンバかどうか調べる</td></tr>
<tr><td width="60%">:py n = len(vim.buffers)</td><td width="40%">要素の個數</td></tr>
<tr><td width="60%">:py for b in vim.buffers:</td><td width="40%">バッファリストのイテレート</td></tr>
</table>
<span id="python_002dwindows"></span><span id="index-python_002dwindows"></span>
</dd>
<dt>vim.windows</dt>
<dd><p>一聯の vim ウィンドウへのアクセスを提供するシーケンスオブジェクト。このオブジェクトは次の操作をサポートしてゐます:
</p><table>
<tr><td width="60%">:py w = vim.windows[i]</td><td width="40%">インデックス化する (讀取り專用)</td></tr>
<tr><td width="60%">:py w in vim.windows</td><td width="40%">メンバかどうか調べる</td></tr>
<tr><td width="60%">:py n = len(vim.windows)</td><td width="40%">要素の個數</td></tr>
<tr><td width="60%">:py for w in vim.windows:</td><td width="40%">シーケンシャルアクセス</td></tr>
</table>
<blockquote>
<p><strong>None:</strong> <br>
vim.windows オブジェクトは常に現在のタブページ內にアクセスします。|<a href="#python_002dtabpage">python-tabpage</a>|.windows オブジェクトは親である |<a href="#python_002dtabpage">python-tabpage</a>| オブジェクトに結びつけられて、常にそのタブページのウィンドウを參照します (タブページが削除されてゐたときは vim.error 例外が發生します)。vim モジュールや |<a href="#python_002dtabpage">python-tabpage</a>| オブジェクトへの參照を維持しなくても、參照は保持されます。プロパティも失はれません。
</p></blockquote>

<span id="python_002dtabpages"></span><span id="index-python_002dtabpages"></span>
</dd>
<dt>vim.tabpages</dt>
<dd><p>Vim のタブページの一覽へのアクセスを提供するシーケンスオブジェクト。このオブジェクトは次の操作をサポートしてゐます:
</p><table>
<tr><td width="60%">:py t = vim.tabpages[i]</td><td width="40%">インデックス化する (讀取り專用)</td></tr>
<tr><td width="60%">:py t in vim.tabpages</td><td width="40%">メンバかどうか調べる</td></tr>
<tr><td width="60%">:py n = len(vim.tabpages)</td><td width="40%">要素の個數</td></tr>
<tr><td width="60%">:py for t in vim.tabpages:</td><td width="40%">シーケンシャルアクセス</td></tr>
</table>
<span id="python_002dcurrent"></span><span id="index-python_002dcurrent"></span>
</dd>
<dt>vim.current</dt>
<dd><p>vim 內で使へる樣々な &quot;現在の&quot; オブジェクトへの、(特定の屬性を通した) アクセスを提供するオブジェクト:
</p><table>
<tr><td width="40%">vim.current.line</td><td width="40%">現在の行 (RW)</td><td width="20%">String</td></tr>
<tr><td width="40%">vim.current.buffer</td><td width="40%">現在のバッファ (RW)</td><td width="20%">Buffer</td></tr>
<tr><td width="40%">vim.current.window</td><td width="40%">現在のウィンドウ (RW)</td><td width="20%">Window</td></tr>
<tr><td width="40%">vim.current.tabpage</td><td width="40%">現在のタブページ (RW)</td><td width="20%">TabPage</td></tr>
<tr><td width="40%">vim.current.range</td><td width="40%">現在の行の範圍 (RO)</td><td width="20%">Range</td></tr>
</table>

<p>最後のものに關しては、若干の說明が必要でせう。<code>:python</code>, <code>:pyfile</code> コマンドで、範圍が指定された場合、この行の範圍は、&quot;現在の範圍&quot; として扱はれます。範圍はバッファに少し似てゐますが、全てのアクセスは行のサブセットに制限されます。詳細は |<a href="#python_002drange">python-range</a>| を參照してください。
</p>
<blockquote>
<p><strong>Note:</strong> <br>
vim.current.{buffer,window,tabpage} に値を代入するときはその値が有效なオブジェクト (|<a href="#python_002dbuffer">python-buffer</a>|, |<a href="#python_002dwindow">python-window</a>|, |<a href="#python_002dtabpage">python-tabpage</a>|) であることが期待されます。
</p>
<p>値を代入するとバッファ、ウィンドウ、またはタブページの切り替へが起こります (|<a href="autocmd_002etxt.html#autocommand">autocommand</a>| も實行される)。これが唯一 python で UI オブジェクトを切り替へる方法です。
</p>
<p>|<a href="#python_002dtabpage">python-tabpage</a>|.window 屬性に代入することはできません。自動コマンドを發行させずに切り替へるには次のやうにします:
</p><pre class="verbatim">py &lt;&lt; EOF
saved_eventignore = vim.options['eventignore']
vim.options['eventignore'] = 'all'
try:
    vim.current.buffer = vim.buffers[2] # バッファ 2 へ切り替へ
finally:
    vim.options['eventignore'] = saved_eventignore
EOF
</pre></blockquote>
<span id="python_002dvars"></span><span id="index-python_002dvars"></span>
</dd>
<dt>vim.vars</dt>
<dd><span id="python_002dvvars"></span><span id="index-python_002dvvars"></span>
</dd>
<dt>vim.vvars</dt>
<dd><p>辭書に似たオブジェクトで、グローバル變數 (|<a href="eval_002etxt.html#g_003a">g:</a>|) と Vim 變數 (|<a href="eval_002etxt.html#v_003a">v:</a>|) への參照です。&lsquo;<code>vim.bindeval(&quot;g:&quot;)</code>&lsquo; と同じですが、こちらの方が速いです。
</p>
<span id="python_002doptions"></span><span id="index-python_002doptions"></span>
</dd>
<dt>vim.options</dt>
<dd><p>グローバルオプションへの讀み書きアクセスを提供するマップオブジェクト (値の取得と設定のみ對應)。
</p><blockquote>
<p><strong>Note:</strong> <br>
|<a href="options_002etxt.html#g_t_003aset">:set</a>| と違ひ、グローバルオプションへのアクセスのみ提供します。このオブジェクトを使つてローカルオプションの値を讀み書きすることはできません。
</p>
<p>指定した名前のグローバルオプションが存在しない場合は KeyError 例外が發生します (例へば |<a href="options_002etxt.html#global_002dlocal">global-local</a>| オプションやグローバルオプションへのアクセスでは KeyError は發生しませんが、ウィンドウオプションやバッファオプションへのアクセスでは例外が發生します)。
</p>
<p>バッファオプションへのアクセスには |<a href="#python_002dbuffer">python-buffer</a>| オブジェクトを使ひます。ウィンドウオプションへのアクセスには |<a href="#python_002dwindow">python-window</a>| オブジェクトを使ひます。
</p></blockquote>

<p>このオブジェクトの型は vim モジュールの &quot;Options&quot; 屬性で取得できます。
</p></dd>
</dl>

<span id="python_002doutput"></span><span id="index-python_002doutput"></span>
<span id="PythonkaranoChu-Li-"></span><h4 class="unnumberedsubsec">Pythonからの出力</h4>
<p>Python コードからの全ての出力は、Vim のメッセージエリアに表示されます。標準出力はインフォメーションメッセージとして、エラー出力はエラーメッセージとして表示されます。
</p>
<p>實裝のレベルでいふと、sys.stdout (print ステートメントによる出力も含む) に向けられる全ての出力が、インフォメーションメッセージとして vim に表示され、sys.stderr (エラートレースバックを含む) に向けられる全ての出力が、エラーメッセージとして vim に表示されてゐます。
</p>
<span id="python_002dinput"></span><span id="index-python_002dinput"></span>
<p>入力 (sys.stdin を通した入力、input(), raw_input() を含む) はサポートされず、プログラムをクラッシュさせる可能性があります。これはたぶん修正されるべき問題です。
</p>
<span id="python2_002ddirectory"></span><span id="python3_002ddirectory"></span><span id="pythonx_002ddirectory"></span><span id="python_002dspecial_002dpath"></span><span id="index-python2_002ddirectory"></span>
<span id="index-python3_002ddirectory"></span>
<span id="index-pythonx_002ddirectory"></span>
<span id="index-python_002dspecial_002dpath"></span>
<span id="Python-niokeru-_0027runtimepath_0027-noChu-Li-"></span><h4 class="unnumberedsubsec">Python における &rsquo;<samp>runtimepath</samp>&rsquo; の處理</h4>

<p>Python では、&rsquo;<samp>runtimepath</samp>&rsquo; のパスのリストを使ふ代はりに、vim.VIM_SPECIAL_PATH といふ特別なディレクトリが使はれます。このディレクトリが sys.path 內で使はれるとき、そして vim.path_hooks が sys.path_hooks 內で使はれるとき、&rsquo;<samp>runtimepath</samp>&rsquo; の各パス {rtp} に對して {rtp}/python2 (or python3) と {rtp}/pythonx (兩バージョンで讀み込まれる) のモジュールがロードされます。
</p>
<p>實裝は以下のやうになつてゐます。ただし實際は C で書かれてゐます:
</p>
<pre class="verbatim">from imp import find_module, load_module
import vim
import sys

class VimModuleLoader(object):
    def __init__(self, module):
        self.module = module

    def load_module(self, fullname, path=None):
        return self.module

def _find_module(fullname, oldtail, path):
    idx = oldtail.find('.')
    if idx &gt; 0:
        name = oldtail[:idx]
        tail = oldtail[idx+1:]
        fmr = find_module(name, path)
        module = load_module(fullname[:-len(oldtail)] + name, *fmr)
        return _find_module(fullname, tail, module.__path__)
    else:
        fmr = find_module(fullname, path)
        return load_module(fullname, *fmr)

# It uses vim module itself in place of VimPathFinder class: it does not 
# matter for python which object has find_module function attached to as 
# an attribute.
class VimPathFinder(object):
    @classmethod
    def find_module(cls, fullname, path=None):
        try:
            return VimModuleLoader(_find_module(fullname, fullname, path or vim._get_paths()))
        except ImportError:
            return None

    @classmethod
    def load_module(cls, fullname, path=None):
        return _find_module(fullname, fullname, path or vim._get_paths())

def hook(path):
    if path == vim.VIM_SPECIAL_PATH:
        return VimPathFinder
    else:
        raise ImportError

sys.path_hooks.append(hook)
</pre>
<dl compact="compact">
<dd><span id="python_002dVIM_005fSPECIAL_005fPATH"></span><span id="index-python_002dVIM_005fSPECIAL_005fPATH"></span>
</dd>
<dt>vim.VIM_SPECIAL_PATH</dt>
<dd><p>Vim のパスフックに關聯付けられた文字列定數。Vim によつて設定されたパスフックが vim.VIM_SPECIAL_PATH 定數以外のパスに對して呼び出された場合は ImportError が發生します。さうでなければ特殊ローダが使用されます。
</p>
<blockquote>
<p><strong>Note:</strong> <br>
この定數の値を直接使用しないこと。常に vim.VIM_SPECIAL_PATH オブジェクトを使用してください。
</p></blockquote>

<span id="python_002dfind_005fmodule"></span><span id="index-python_002dfind_005fmodule"></span>
</dd>
<dt>vim.find_module(...)</dt>
<dd><span id="python_002dpath_005fhook"></span><span id="index-python_002dpath_005fhook"></span>
</dd>
<dt>vim.path_hook(path)</dt>
<dd><p>上述のパスフックの實裝に使はれるメソッドとオブジェクト。sys.meta_path で vim.path_hook を使つて何かをするやうなことがなければ、これらを直接使用することはないでせう。これらのオブジェクトが Vim の將來のバージョンでも存在するかどうかは保證されません。
</p>
<span id="python_002d_005fget_005fpaths"></span><span id="index-python_002d_005fget_005fpaths"></span>
</dd>
<dt>vim._get_paths</dt>
<dd><p>パスフックで檢索されるパスのリストを返すメソッド。將來のバージョンのことを考へるならこのメソッドに依存すべきではありません。デバッグなどに使ひます。
</p>
<p>&rsquo;<samp>runtimepath</samp>&rsquo; の各パスに對して {rtp}/python2 (or {rtp}/python3) と {rtp}/pythonx ディレクトリのリストを返します。
</p></dd>
</dl>

<span id="python_002dbuffer"></span><span id="index-python_002dbuffer"></span>
<span id="g_t3_002e-batuhuaobuziekuto"></span><h3 class="section">3. バッファオブジェクト</h3>

<p>バッファオブジェクトは、vim のバッファを表します。バッファオブジェクトを取得するはいくつかの方法があります:
</p><ul>
<li> vim.current.buffer を介して (|<a href="#python_002dcurrent">python-current</a>|)
</li><li> vim.buffers のインデックス化から (|<a href="#python_002dbuffers">python-buffers</a>|)
</li><li> ウィンドウの &quot;buffer&quot; 屬性から (|<a href="#python_002dwindow">python-window</a>|)
</li></ul>

<p>バッファオブジェクトは 2 つの讀み取り專用屬性を持つてゐます。name はバッファのフルファイル名です。number はバッファ番號です。バッファオブジェクトは 3 つのメソッドを持つてゐます (append, mark, range 以下參照)。
</p>
<p>バッファオブジェクトは、シーケンスオブジェクトとして扱ふこともできます。この文脈では、バッファオブジェクトは文字列のリスト (さう、これは mutable です) のやうに振舞ひます。
</p>
<p>各要素はバッファの行です。有用なシーケンス操作の全て、つまり、インデックス操作、インデックスによる代入、スライシング、スライスへの代入が期待通りに機能します。
</p><blockquote>
<p><strong>Note:</strong> <br>
バッファのインデックス操作 (スライシング) の結果は、文字列 (文字列のリスト) であることを注意しておきます。これはひとつの例外的な結果をもたらします - b[:] は b とは異なるのです。特に、&quot;b[:] = None&quot; はバッファの全てを削除するが、&quot;b = None&quot; は變數 b を更新するだけで、バッファには何の影響も與へません。
</p></blockquote>

<p>バッファのインデックスは、Python では普通はゼロから始まります。これは、1 から始まる vim の行番號と異なります。これは、特に vim の行番號を使ふ marks (以下を參照) を扱ふ際に問題となります。
</p>
<p>バッファオブジェクトの屬性は次の通りです:
</p><table>
<tr><td width="30%">b.vars</td><td width="70%">バッファ變數 (|<a href="eval_002etxt.html#buffer_002dvariable">buffer-variable</a>|) にアクセスするための辭書オブジェクト。</td></tr>
<tr><td width="30%">b.options</td><td width="70%">バッファオプションにアクセスするためのマップオブジェクト (値の取得、設定、削除をサポート)。ウィンドウオプションへのアクセスは |<a href="#python_002dwindow">python-window</a>|.options を使つてください。ウィンドウオプションに對しては KeyError 例外が發生します。グローバルの値とローカルの値を兩方持つオプション (|<a href="options_002etxt.html#global_002dlocal">global-local</a>|) で、ローカルの値がない場合は None が返ります。</td></tr>
<tr><td width="30%">b.name</td><td width="70%">文字列。讀み書き可。バッファ名 (フルパス)。
<blockquote>
<p><strong>Note:</strong> <br>
b.name に値を設定すると自動コマンドの |<a href="autocmd_002etxt.html#BufFilePre">BufFilePre</a>| と |<a href="autocmd_002etxt.html#BufFilePost">BufFilePost</a>| イベントが發生します。
</p></blockquote></td></tr>
<tr><td width="30%">b.number</td><td width="70%">バッファ番號。|<a href="#python_002dbuffers">python-buffers</a>| のキーとして使へます。讀み込み專用。</td></tr>
<tr><td width="30%">b.valid</td><td width="70%">True または False。關聯バッファが破毀されるとバッファオブジェクトは無效となる。</td></tr>
</table>

<p>バッファオブジェクトのメソッドは次の通りです:
</p><table>
<tr><td width="40%">b.append(str)</td><td width="60%">バッファに行を追加</td></tr>
<tr><td width="40%">b.append(str, nr)</td><td width="60%">バッファの &quot;nr&quot; 行目の下に行を追加。</td></tr>
<tr><td width="40%">b.append(list)</td><td width="60%">バッファに一聯の行を追加
<blockquote>
<p><strong>Note:</strong> <br>
append メソッドに文字列のリストを與へるオプションは、Python 組込みのリストオブジェクトの等價なメソッドとは違ふことに注意してください
</p></blockquote></td></tr>
<tr><td width="40%">b.append(list, nr)</td><td width="60%">バッファの &quot;nr&quot; 行目の下に一聯の行を追加</td></tr>
<tr><td width="40%">b.mark(name)</td><td width="60%">名前付きマークの位置を示す(row,col)の組を返す (これは[]&quot;&lt;&gt; marksでも得られる)</td></tr>
<tr><td width="40%">b.range(s,e)</td><td width="60%">與へられたバッファの s 行目から e 行目 (s 行と e 行も含む |<a href="motion_002etxt.html#inclusive">inclusive</a>|) を示すレンジオブジェクト (|<a href="#python_002drange">python-range</a>| を參照) を返す</td></tr>
</table>

<blockquote>
<p><strong>Note:</strong> <br>
行を追加するときは、その行に改行文字 &rsquo;\n&rsquo; が含まれてはなりません。末尾の &rsquo;\n&rsquo; は許されますが、無視されます。そのため次のやうなことができます:
</p><pre class="verbatim">:py b.append(f.readlines())
</pre></blockquote>

<p>バッファオブジェクトの型は vim モジュールの &quot;Buffer&quot; 屬性で取得できます。
</p>
<p>例 (b は現在のバッファに割り當てられてゐるとします)
</p><table>
<tr><td width="60%">:py print b.name</td><td width="40%">バッファのファイル名を出力</td></tr>
<tr><td width="60%">:py b[0] = &quot;hello!!!&quot;</td><td width="40%">先頭の行を置換</td></tr>
<tr><td width="60%">:py b[:] = None</td><td width="40%">全てのバッファを削除</td></tr>
<tr><td width="60%">:py del b[:]</td><td width="40%">全てのバッファを削除</td></tr>
<tr><td width="60%">:py b[0:0] = &quot;add a line&quot;</td><td width="40%">先頭に行を追加</td></tr>
<tr><td width="60%">:py del b[2]</td><td width="40%">行を削除 (３番目)</td></tr>
<tr><td width="60%">:py b.append(&quot;bottom&quot;)</td><td width="40%">最後に行を追加</td></tr>
<tr><td width="60%">:py n = len(b)</td><td width="40%">行數</td></tr>
<tr><td width="60%">:py (row,col) = b.mark(&rsquo;a&rsquo;)</td><td width="40%">名前付きマーク</td></tr>
<tr><td width="60%">:py r = b.range(1,5)</td><td width="40%">バッファの部分範圍</td></tr>
<tr><td width="60%">:py b.vars[&quot;foo&quot;] = &quot;bar&quot;</td><td width="40%">b:foo への代入</td></tr>
<tr><td width="60%">:py b.options[&quot;ff&quot;] = &quot;dos&quot;</td><td width="40%">ファイルフォーマット設定</td></tr>
<tr><td width="60%">:py del b.options[&quot;ar&quot;]</td><td width="40%">:set autoread&lt; と同じ</td></tr>
</table>

<span id="python_002drange"></span><span id="index-python_002drange"></span>
<span id="g_t4_002e-renziobuziekuto"></span><h3 class="section">4. レンジオブジェクト</h3>

<p>レンジオブジェクトは、vim バッファの一部分を表します。レンジオブジェクトを取得するにはいくつかの方法があります:
</p><ul>
<li> vim.current.rangeを介して (|<a href="#python_002dcurrent">python-current</a>|)
</li><li> バッファのrange()メソッドから (|<a href="#python_002dbuffer">python-buffer</a>|)
</li></ul>

<p>レンジオブジェクトの操作は、バッファオブジェクトのそれとほとんど同じです。しかし、全ての操作は範圍內の行に制限されます (もちろん、行の範圍は部分の割當て、行の削除、あるいは range.append() メソッドによつて變更できます)。
</p>
<p>レンジオブジェクトの屬性:
</p><table>
<tr><td width="20%">r.start</td><td width="80%">選擇範圍でのバッファ內の最初の行。</td></tr>
<tr><td width="20%">r.end</td><td width="80%">選擇範圍でのバッファ內の最後の行。</td></tr>
</table>

<p>レンジオブジェクトのメソッド:
</p><table>
<tr><td width="40%">r.append(str)</td><td width="60%">その範圍に行を追加する</td></tr>
<tr><td width="40%">r.append(str, nr)</td><td width="60%">&quot;nr&quot; 行目の後に追加する</td></tr>
<tr><td width="40%">r.append(list)</td><td width="60%">その範圍にリストで與へられた複數行を追加する
<blockquote>
<p><strong>Note:</strong> <br>
これは Python のリストオブジェクトに對する操作とは異なることに注意してください。
</p></blockquote></td></tr>
<tr><td width="40%">r.append(list, nr)</td><td width="60%">&quot;nr&quot; 行目の後に追加する</td></tr>
</table>

<p>Range オブジェクトの型は vim モジュールの &quot;Range&quot; 屬性で取得できます。
</p>
<p>例 (r は現在の範圍であるとする):
</p><pre class="verbatim"># 既定のプリンタに範圍內の全ての行を送る
vim.command(&quot;%d,%dhardcopy!&quot; % (r.start+1,r.end+1))
</pre>
<span id="python_002dwindow"></span><span id="index-python_002dwindow"></span>
<span id="g_t5_002e-uindouobuziekuto"></span><h3 class="section">5. ウィンドウオブジェクト</h3>

<p>ウィンドウオブジェクトは、vim のウィンドウを表現します。ウィンドウオブジェクトを取得するには、いくつかの方法があります:
</p><ul>
<li> vim.current.window を介して (|<a href="#python_002dcurrent">python-current</a>|)
</li><li> vim.windows のインデックス化から (|<a href="#python_002dwindows">python-windows</a>|)
</li><li> タブページの &quot;windows&quot; 屬性のインデックス化から (|<a href="#python_002dtabpage">python-tabpage</a>|)
</li><li> タブページの &quot;window&quot; 屬性から (|<a href="#python_002dtabpage">python-tabpage</a>|)
</li></ul>

<p>ウィンドウオブジェクトは、それらの屬性を通してのみ操作できます。これらはメソッドを持たず、シーケンスも他のインターフェイスもありません。
</p>
<p>ウィンドウの屬性:
</p><table>
<tr><td width="40%">buffer (讀取り專用)</td><td width="60%">そのウィンドウに表示されてゐるバッファ</td></tr>
<tr><td width="40%">cursor (讀み書き)</td><td width="60%">そのウィンドウの現在のカーソルの位置これは (row,col) の組で表される</td></tr>
<tr><td width="40%">height (讀み書き)</td><td width="60%">ウィンドウの高さ、行の數で</td></tr>
<tr><td width="40%">width (讀み書き)</td><td width="60%">ウィンドウの幅、列の數で</td></tr>
<tr><td width="40%">vars (讀み專用)</td><td width="60%">ウィンドウの |<a href="eval_002etxt.html#w_003a">w:</a>| 變數。この屬性自體には代入できないが、この屬性を使つてウィンドウ變數を變更できる。</td></tr>
<tr><td width="40%">options (讀み專用)</td><td width="60%">ウィンドウオプション。この屬性自體には代入できないが、この屬性を使つてウィンドウオプションを變更できる。ウィンドウオプションのみアクセス可能。バッファオプションは |<a href="#python_002dbuffer">python-buffer</a>| で、グローバルオプションは |<a href="#python_002doptions">python-options</a>| でアクセスする。オプションがグローバルの値とローカルの値を兩方持つオプション (|<a href="options_002etxt.html#global_002dlocal">global-local</a>|) で、ローカルの値がない場合は None が返ります。</td></tr>
<tr><td width="40%">number (讀み專用)</td><td width="60%">ウィンドウ番號。1 つ目のウィンドウの番號は 1 です。番號が不明な場合は 0 が返ります (例へば、他のタブページに關聯付けられたウィンドウオブジェクトである場合)。</td></tr>
<tr><td width="40%">row, col (讀み專用)</td><td width="60%">スクリーン上でのウィンドウの表示位置。値は 0 から始まります。</td></tr>
<tr><td width="40%">tabpage (讀み專用)</td><td width="60%">ウィンドウのタブページ。</td></tr>
<tr><td width="40%">valid (read-write)</td><td width="60%">True または False。關聯ウィンドウが閉ぢられるとウィンドウオブジェクトは無效になる。</td></tr>
</table>

<p>height はスクリーンが水平方向に分割されてゐるときのみ書き込み可能です。
</p>
<p>width はスクリーンが垂直方向に分割されてゐるときのみ書き込み可能です。
</p>
<p>Window オブジェクトの型は vim モジュールの &quot;Window&quot; 屬性で取得できます。
</p>
<span id="python_002dtabpage"></span><span id="index-python_002dtabpage"></span>
<span id="g_t6_002e-tabupeziobuziekuto"></span><h3 class="section">6. タブページオブジェクト</h3>

<p>タブページオブジェクトは、vim のタブページを表現します。タブページオブジェクトを取得するにはいくつかの方法があります:
</p><ul>
<li> vim.current.tabpage を介して (|<a href="#python_002dcurrent">python-current</a>|)
</li><li> vim.tabpages のインデックス化から (|<a href="#python_002dtabpages">python-tabpages</a>|)
</li></ul>

<p>このオブジェクトを使つてタブページウィンドウにアクセスすることができます。これらはメソッドを持たず、シーケンスも他のインターフェイスもありません。
</p>
<p>タブページの屬性:
</p><table>
<tr><td width="30%">number</td><td width="70%">|<a href="eval_002etxt.html#tabpagenr_0028_0029">tabpagenr()</a>| が返すやうなタブページ番號。</td></tr>
<tr><td width="30%">windows</td><td width="70%">|<a href="#python_002dwindows">python-windows</a>| と同樣だが、現在のタブページ用。</td></tr>
<tr><td width="30%">vars</td><td width="70%">タブページの |<a href="eval_002etxt.html#t_003a">t:</a>| 變數。</td></tr>
<tr><td width="30%">window</td><td width="70%">現在のタブページウィンドウ。</td></tr>
<tr><td width="30%">valid</td><td width="70%">True または False。タブページオブジェクトは、關聯するタブページがクローズされると無效になる。</td></tr>
</table>

<p>タブページオブジェクトの型は vim モジュールの &quot;TabPage&quot; 屬性で取得できます。
</p>
<span id="python_002dbindeval_002dobjects"></span><span id="index-python_002dbindeval_002dobjects"></span>
<span id="g_t7_002e-vim_002ebindeval-obuziekuto"></span><h3 class="section">7. vim.bindeval オブジェクト</h3>

<span id="python_002dDictionary"></span><span id="index-python_002dDictionary"></span>
<span id="vim_002eDictionary-obuziekuto"></span><h4 class="unnumberedsubsec">vim.Dictionary オブジェクト</h4>
<p>Vim の辭書 (|<a href="eval_002etxt.html#Dictionary">Dictionary</a>|) にアクセスするための辭書系オブジェクト。
</p><span id="Shu-Xing-_003a"></span><h4 class="unnumberedsubsubsec">屬性:</h4>
<dl compact="compact">
<dd><span id="python_002d_002elocked"></span><span id="index-python_002d_002elocked"></span>
</dd>
<dt>locked</dt>
<dd><p>次の値のどれか
</p><table>
<thead><tr><th width="40%">値</th><th width="60%">說明</th></tr></thead>
<tr><td width="40%">ゼロ</td><td width="60%">變數はロックされてゐない</td></tr>
<tr><td width="40%">vim.VAR_LOCKED</td><td width="60%">變數はロックされてゐる。ロック解除可能</td></tr>
<tr><td width="40%">vim.VAR_FIXED</td><td width="60%">變數はロックされてゐる。ロック解除不可能</td></tr>
</table>
<p>讀み書き可。&lsquo;True&lsquo; か &lsquo;False&lsquo; を代入することでロックを變更できる。再歸的なロックはサポートされてゐない。
</p></dd>
<dt>scope</dt>
<dd><p>次の値のどれか
</p><table>
<thead><tr><th width="40%">値</th><th width="60%">說明</th></tr></thead>
<tr><td width="40%">ゼロ</td><td width="60%">辭書はスコープ辭書ではない</td></tr>
<tr><td width="40%">vim.VAR_DEF_SCOPE</td><td width="60%">辭書は |<a href="eval_002etxt.html#g_003a">g:</a>| か |<a href="eval_002etxt.html#l_003a">l:</a>| である。</td></tr>
<tr><td width="40%">vim.VAR_SCOPE</td><td width="60%">他のスコープ變數 |<a href="eval_002etxt.html#internal_002dvariables">internal-variables</a>| 參照。</td></tr>
</table>
</dd>
</dl>
<span id="mesotudo-_0028Note_003a-kiwadoYin-Shu-hasapotosareteinai_0029_003a"></span><h4 class="unnumberedsubsubsec">メソッド (Note: キーワード引數はサポートされてゐない):</h4>
<table>
<thead><tr><th width="30%">メソッド</th><th width="70%">說明</th></tr></thead>
<tr><td width="30%">keys()</td><td width="70%">辭書のキーのリストを返す。</td></tr>
<tr><td width="30%">values()</td><td width="70%">辭書の値のリストを返す。</td></tr>
<tr><td width="30%">items()</td><td width="70%">辭書の內容を 2 値タプルのリストで返す。</td></tr>
<tr><td width="30%">update(iterable), update(dictionary), update(**kwargs)</td><td width="70%">辭書にキーを追加する。</td></tr>
<tr><td width="30%">get(key[, default=None])</td><td width="70%">辭書からキーの値を取得する。キーが存在しない場合は default が返る。</td></tr>
<tr><td width="30%">pop(key[, default])</td><td width="70%">辭書からキーを取り除き、その値を返す。キーが存在しない場合は、default が指定されてゐたらその値を返す。指定されてゐなければ KeyError 例外が發生する。</td></tr>
<tr><td width="30%">popitem()</td><td width="70%">辭書からランダムにキーを取り除き (key, value) のペアを返す。</td></tr>
<tr><td width="30%">has_key(key)</td><td width="70%">辭書がキーを持つてゐるかを確認する。&lsquo;key in dict&lsquo; と同じ。</td></tr>
<tr><td width="30%">__new__(), __new__(iterable), __new__(dictionary), __new__(update)</td><td width="70%">&lsquo;vim.Dictionary()&lsquo; を使つて vim の辭書を作成できる。&lsquo;d=vim.Dictionary(arg)&lsquo; は &lsquo;d=vim.bindeval(&rsquo;{}&rsquo;);d.update(arg)&lsquo; と同じ。引數がない場合は空の辭書が作成される。</td></tr>
</table>

<p>例:
</p><table>
<tr><td width="70%">d = vim.Dictionary(food=&quot;bar&quot;)</td><td width="30%">コンストラクタ</td></tr>
<tr><td width="70%">d[&rsquo;a&rsquo;] = &rsquo;b&rsquo;</td><td width="30%">アイテム代入</td></tr>
<tr><td width="70%">print d[&rsquo;a&rsquo;]</td><td width="30%">アイテム取得</td></tr>
<tr><td width="70%">d.update({&rsquo;c&rsquo;: &rsquo;d&rsquo;})</td><td width="30%">.update(dictionary)</td></tr>
<tr><td width="70%">d.update(e=&rsquo;f&rsquo;)</td><td width="30%">.update(**kwargs)</td></tr>
<tr><td width="70%">d.update(((&rsquo;g&rsquo;, &rsquo;h&rsquo;), (&rsquo;i&rsquo;, &rsquo;j&rsquo;)))</td><td width="30%">.update(iterable)</td></tr>
<tr><td width="70%">for key in d.keys():</td><td width="30%">.keys()</td></tr>
<tr><td width="70%">for val in d.values():</td><td width="30%">.values()</td></tr>
<tr><td width="70%">for key, val in d.items():</td><td width="30%">.items()</td></tr>
<tr><td width="70%">print isinstance(d, vim.Dictionary)</td><td width="30%">True</td></tr>
<tr><td width="70%">for key in d:</td><td width="30%">キーのイテレーション</td></tr>
<tr><td width="70%">class Dict(vim.Dictionary):</td><td width="30%">サブクラス化</td></tr>
</table>
<blockquote>
<p><strong>Note:</strong> <br>
キーをイテレーションしてゐる最中に辭書を變更してはいけない。
</p></blockquote>

<span id="python_002dList"></span><span id="index-python_002dList"></span>
<span id="vim_002eList-obuziekuto"></span><h4 class="unnumberedsubsec">vim.List オブジェクト</h4>
<p>Vim のリスト (|<a href="eval_002etxt.html#List">List</a>|) にアクセスするためのシーケンス系オブジェクト。&lsquo;.locked&lsquo; 屬性をサポートしてゐる (|<a href="#python_002d_002elocked">python-.locked</a>| 參照)。さらに以下のメソッドをサポートしてゐる:
</p><table>
<thead><tr><th width="50%">メソッド</th><th width="50%">說明</th></tr></thead>
<tr><td width="50%">extend(item)</td><td width="50%">リストにアイテムを追加する。</td></tr>
<tr><td width="50%">__new__(), __new__(iterable)</td><td width="50%">&lsquo;vim.List()&lsquo; を使つて vim のリストを作成できる。&lsquo;l=vim.List(iterable)&lsquo; は &lsquo;l=vim.bindeval(&rsquo;[]&rsquo;);l.extend(iterable)&lsquo; と同じ。引數がない場合は空のリストが作成される。</td></tr>
</table>
<p>例:
</p><table>
<tr><td width="50%">l = vim.List(&quot;abc&quot;)</td><td width="50%">コンストラクタ。結果: [&rsquo;a&rsquo;, &rsquo;b&rsquo;, &rsquo;c&rsquo;]</td></tr>
<tr><td width="50%">l.extend([&rsquo;abc&rsquo;, &rsquo;def&rsquo;])</td><td width="50%">.extend() メソッド</td></tr>
<tr><td width="50%">print l[1:]</td><td width="50%">スライス</td></tr>
<tr><td width="50%">l[:0] = [&rsquo;ghi&rsquo;, &rsquo;jkl&rsquo;]</td><td width="50%">スライス代入</td></tr>
<tr><td width="50%">print l[0]</td><td width="50%">アイテム取得</td></tr>
<tr><td width="50%">l[0] = &rsquo;mno&rsquo;</td><td width="50%">代入</td></tr>
<tr><td width="50%">for i in l:</td><td width="50%">イテレーション</td></tr>
<tr><td width="50%">print isinstance(l, vim.List)</td><td width="50%">True</td></tr>
<tr><td width="50%">class List(vim.List):</td><td width="50%">サブクラス化</td></tr>
</table>

<span id="python_002dFunction"></span><span id="index-python_002dFunction"></span>
<span id="vim_002eFunction-obuziekuto"></span><h4 class="unnumberedsubsec">vim.Function オブジェクト</h4>
<p>Vim の函數參照 (|<a href="eval_002etxt.html#Funcref">Funcref</a>|) と似た動作をする函數系オブジェクト。特別な引數として &lsquo;self&lsquo; を指定できる (|<a href="eval_002etxt.html#Dictionary_002dfunction">Dictionary-function</a>| 參照)。&lsquo;vim.Function(name)&lsquo; を使つて作成することもできる。これは &lsquo;vim.bindeval(&rsquo;function(%s)&rsquo;%json.dumps(name))&lsquo; と同じ。
</p>
<span id="Shu-Xing--_0028Du-miQu-riZhuan-Yong-_0029_003a"></span><h4 class="unnumberedsubsubsec">屬性 (讀み取り專用):</h4>
<table>
<thead><tr><th width="30%">屬性名</th><th width="70%">說明</th></tr></thead>
<tr><td width="30%">name</td><td width="70%">函數名</td></tr>
<tr><td width="30%">args</td><td width="70%">&lsquo;None&lsquo; または引數を示す |<a href="#python_002dList">python-List</a>| オブジェクト。これはこの屬性をリクエストするたびに作られる引數のコピーであることに注意してください。このリストに對する變更は無視されます。(ただし引數リスト內のコンテナについては無視されません。これは |<a href="eval_002etxt.html#deepcopy_0028_0029">deepcopy()</a>| ではなく |<a href="eval_002etxt.html#copy_0028_0029">copy()</a>| と同樣です)</td></tr>
<tr><td width="30%">self</td><td width="70%">&lsquo;None&lsquo; または自身の辭書である |<a href="#python_002dDictionary">python-Dictionary</a>| オブジェクト。呼び出し時に明示的な &lsquo;self&lsquo; キーワードが使はれた場合には、渡されるオブジェクトでこの屬性はオーバーライドされます。</td></tr>
<tr><td width="30%">auto_rebind</td><td width="70%">ブール値。Python のオブジェクトから作られ Vim script の辭書に格納された部分適用が、その辭書が參照された際に自動的に再バインドされる場合に &lsquo;True&lsquo; となります。Vim script で說明すると &lsquo;dict.func&lsquo; (auto_rebind=True) と&lsquo;function(dict.func,dict)&lsquo; (auto_rebind=False) の違ひになります。&lsquo;self&lsquo; 屬性の値が &lsquo;None&lsquo; の場合には、この屬性値には意味がありません。</td></tr>
</table>

<p>コンストラクタは、加へて &lsquo;args&lsquo;, &lsquo;self&lsquo; そして &lsquo;auto_rebind&lsquo; キーワードを受け付けます。&lsquo;args&lsquo; と &lsquo;self&lsquo; どちらか一方、もしくは兩方が與へられた場合には、部分適用が生成されます。詳しくは |<a href="eval_002etxt.html#function_0028_0029">function()</a>| を參照してください。&lsquo;auto_rebind&lsquo; は &lsquo;self&lsquo; だけが與へられた場合にのみ使はれます。さうでない場合には、それが與へられたかどうかにかかはらず &lsquo;True&lsquo; であると見做されます。&lsquo;self&lsquo; が與へられた場合には、そのデフォルト値は &lsquo;False&lsquo; です。
</p>
<p>例:
</p><pre class="verbatim">f = vim.Function('tr')                  # コンストラクタ
print f('abc', 'a', 'b')                # tr('abc', 'a', 'b') 呼び出し
vim.command('''
    function DictFun() dict
        return self
    endfunction
''')
f = vim.bindeval('function(&quot;DictFun&quot;)')
print f(self={})                        # call('DictFun', [],{})と同じ
print isinstance(f, vim.Function)       # True

p = vim.Function('DictFun', self={})
print f()
p = vim.Function('tr', args=['abc', 'a'])
print f('b')
</pre>
<span id="python_002dpyeval"></span><span id="index-python_002dpyeval"></span>
<span id="g_t8_002e-Vim-Guan-Shu--pyeval_0028_0029-to-py3eval_0028_0029"></span><h3 class="section">8. Vim 函數 pyeval() と py3eval()</h3>

<p>雙方向インターフェイスを容易にするため、|<a href="eval_002etxt.html#pyeval_0028_0029">pyeval()</a>| 函數と |<a href="eval_002etxt.html#py3eval_0028_0029">py3eval()</a>| 函數を使つて Python の式を評價して、その値を Vim script に渡すことができます。|<a href="eval_002etxt.html#pyxeval_0028_0029">pyxeval()</a>| も使用可能です。
</p>
<p>Python での &quot;None&quot; は v:none に變換されます。
</p>
<span id="python_002ddynamic"></span><span id="index-python_002ddynamic"></span>
<span id="g_t9_002e-Dong-De-rodeingu"></span><h3 class="section">9. 動的ローディング</h3>

<p>MS-Windows と UNIX では Python ライブラリを動的に讀み込むことが可能です。これを行ふと |<a href="various_002etxt.html#g_t_003aversion">:version</a>| の出力に |<a href="various_002etxt.html#g_t_002bpython_002fdyn">+python/dyn</a>| もしくは |<a href="various_002etxt.html#g_t_002bpython3_002fdyn">+python3/dyn</a>| が含まれるやうになります。
</p>
<p>この場合、Vim は必要なときだけ Python の DLL ファイル、もしくは共有ライブラリファイルを檢索します。Python インターフェイスを使はないときは DLL を必要としないので、DLL なしで Vim を使ふことができます。
</p>

<span id="MS_002dWindows-5"></span><h4 class="unnumberedsubsec">MS-Windows</h4>

<p>Windows で Python インターフェイスを使ふには、Python の DLL が檢索パス內に存在しなければなりません。コンソールウィンドウで &quot;path&quot; とタイプすると、どのディレクトリが檢索パスとなるか表示することができます。また &rsquo;<samp>pythondll</samp>&rsquo; か &rsquo;<samp>pythonthreedll</samp>&rsquo; オプションを Python の DLL を指定するのに使ふこともできます。
</p>
<p>DLL の名前は Vim をコンパイルした時の Python のバージョンに一致しなければなりません。現在その名前は &quot;python27.dll&quot; です。これは Python 2.7 用です。これは &rsquo;<samp>pythondll</samp>&rsquo; の既定値です。Python 3 の場合は python36.dll (Python3.6) です。これを確かめるには、&quot;gvim.exe&quot; を開き、&quot;python\d*.dll\c&quot; を檢索してください。
</p>

<span id="Unix-5"></span><h4 class="unnumberedsubsec">Unix</h4>

<p>&rsquo;<samp>pythondll</samp>&rsquo; と &rsquo;<samp>pythonthreedll</samp>&rsquo; オプションを、コンパイル時に DYNAMIC_PYTHON_DLL と DYNAMIC_PYTHON3_DLL で指定されてゐる Python の共有ライブラリのファイルの、代はりを指定するのに使へます。共有ライブラリのバージョンは Vim をコンパイルする時に用いた Python 2.x または Python 3 のバージョンと一致してゐなければなりません。
</p>
<span id="python3"></span><span id="index-python3"></span>
<span id="g_t10_002e-Python-3"></span><h3 class="section">10. Python 3</h3>

<span id="g_t_003apy3"></span><span id="g_t_003apython3"></span><span id="index-_003apy3"></span>
<span id="index-_003apython3"></span>
<p>|<a href="#g_t_003apy3">:py3</a>| コマンドと |<a href="#g_t_003apython3">:python3</a>| コマンドは |<a href="#g_t_003apython">:python</a>| と同樣に機能します。&lsquo;:py3&lsquo; コマンドが機能するか簡單にチェックするには:
</p><pre class="verbatim">:py3 print(&quot;Hello&quot;)
</pre>
<p>使つてゐる Python のバージョンを見るには:
</p><pre class="verbatim">:py3 import sys
:py3 print(sys.version)
</pre><span id="g_t_003apy3file"></span><span id="index-_003apy3file"></span>
<p>&lsquo;:py3file&lsquo; コマンドは &lsquo;:pyfile&lsquo; と同樣に機能します。
<span id="g_t_003apy3do"></span><span id="index-_003apy3do"></span>
&lsquo;:py3do&lsquo; コマンドは &lsquo;:pydo&lsquo; と同樣に機能します。
</p>

<p>Vim のビルドは 4 種類あります (:version の出力):
</p><ol>
<li> Python サポートなし      (-python, -python3)
</li><li> Python 2 サポートのみ    (+python or +python/dyn, -python3)
</li><li> Python 3 サポートのみ    (-python, +python3 or +python3/dyn)
</li><li> Python 2 と 3 のサポート (+python/dyn, +python3/dyn)
</li></ol>

<span id="python_002d2_002dand_002d3"></span><span id="index-python_002d2_002dand_002d3"></span>
<p>特殊ケース 4 に付いてもう少し詳細に說明します:
</p>
<p>Python 2 と Python 3 をサポートするにはそれらを動的ロードする必要があります。
</p>
<p>Linux/Unix システムで動的ロード時にグローバルシンボルをインポートすると、2 番目にロードした Python が使はれたときにクラッシュが發生します。そのため、グローバルシンボルをロードして 1 つの Python バージョンだけを使ふか、グローバルシンボルをロードしないかのどちらかしかありません。後者は特定のライブラリ (シンボルが Vim から提供されてゐることを期待してゐるライブラリ) において Python の&quot;import&quot; が失敗するやうになります。
<span id="E836"></span><span id="E837"></span><span id="index-E836"></span>
<span id="index-E837"></span>
</p>
<p>Vim のコンフィグスクリプトは、ある標準の Python ライブラリ (termios) に基づき、すべてのライブラリについて推測を行ひます。このライブラリを兩方の Python バージョンでインポートできるなら、兩方のバージョンを Vim の中で同時に利用できます。さうでない場合は、どちらか最初に使はれたもののみが利用可能になります。もう一方を使はうとすると E836 か E837 のエラーメッセージが表示されるでせう。
</p>
<p>Vim の動作はコンフィグを實行したシステムに依存します。Python の兩方のバージョンが &lsquo;<samp>--enable-shared</samp>&rsquo; 付きでビルドされてゐるなら、兩方のバージョンを同時に使用できます。ただし libPython にリンクしてゐないサードパーティライブラリに對してはまだ問題は解決しません。
</p>
<p>これらの問題に對する對處療法:
</p><ol>
<li> 問題のライブラリを libpython.so にリンクする形で再コンパイルする。
</li><li> Vim を再コンパイルして 1 つの Python バージョンのみ有效にする。
</li><li> コンフィグ實行後に auto/config.h の PY_NO_RTLD_GLOBAL の定義を削除する。これは Vim がクラッシュするやうになるでせう。
</li></ol>

<span id="E880"></span><span id="index-E880"></span>
<p>Python 內で SystemExit 例外を發生させても Vim は終了しない。次のやうにする:
</p><pre class="verbatim">:py vim.command(&quot;qall!&quot;)
</pre>
<span id="has_002dpython"></span><span id="index-has_002dpython"></span>
<p>どのバージョンの Python が利用可能になつてゐるかは次のコマンドで確認できます:
</p><pre class="verbatim">if has('python')
  echo 'there is Python 2.x'
endif
if has('python3')
  echo 'there is Python 3.x'
endif
</pre>
<blockquote>
<p><strong>Note:</strong> <br>
Python の 2 と 3 の兩方が利用可能で、Python が動的ロードされるやうになつてゐる場合、この has() 呼び出しによつてそれらがロードされます。もし、同時にロードできるのがどちらか一方だけだつた場合、Python の 2 と 3 のどちらが利用できるか調べるだけで、もう一方は利用できなくなります。
</p></blockquote>

<p>この動的ライブラリのローディングを防ぐためには、單に Vim が Python をサポートした狀態でコンパイルされてゐるかどうかを確認します:
</p><pre class="verbatim">if has('python_compiled')
  echo 'compiled with Python 2.x support'
  if has('python_dynamic')
    echo 'Python 2.x dynamically loaded'
  endif
endif
if has('python3_compiled')
  echo 'compiled with Python 3.x support'
  if has('python3_dynamic')
    echo 'Python 3.x dynamically loaded'
  endif
endif
</pre>
<p>實行時ライブラリが見つからなかつた場合は Python の動的ローディングは失敗しますが、このコードは正しくロードされたかどうかを表示することにもなります。
</p>
<span id="python_005fx"></span><span id="pythonx"></span><span id="index-python_005fx"></span>
<span id="index-pythonx"></span>
<span id="g_t11_002e-Python-X"></span><h3 class="section">11. Python X</h3>

<p>多くの python コードは、python 2.6+ と python 3 の兩方で動くことができるやうに書けるため、pyx* 函數とコマンドが用意されました。それらは、Python 2 や 3 向けの變種とまつたく同じやうに動作しますが、&rsquo;<samp>pyxversion</samp>&rsquo; 設定を用ゐて Python のバージョンを選擇できる點が異なります。
</p>
<p>Python コマンドに Python 2 と 3 のどちらを使ひたいかに應じて、|<a href="starting_002etxt.html#g_t_002evimrc">.vimrc</a>| の中で &rsquo;<samp>pyxversion</samp>&rsquo; を設定してください。もしこの設定を實行時に變更すると、プラグインの狀態 (例へば初期化など) が失はれる危險性があります。
</p>
<p>モジュールを使用したい場合には、{rtp}/pythonx ディレクトリの中に置くことができます。|<a href="#pythonx_002ddirectory">pythonx-directory</a>| を參照してください。
</p>
<span id="g_t_003apyx"></span><span id="g_t_003apythonx"></span><span id="index-_003apyx"></span>
<span id="index-_003apythonx"></span>
<p>&lsquo;<code>:pyx</code>&lsquo; コマンドと &lsquo;<code>:pythonx</code>&lsquo; コマンドは &lsquo;<code>:python</code>&lsquo; と同樣に機能します。&lsquo;<code>:pyx</code>&lsquo; コマンドが機能するか簡單にチェックするには:
</p><pre class="verbatim">:pyx print(&quot;Hello&quot;)
</pre>
<p>使つてゐる Python のバージョンを見るには:
</p><pre class="verbatim">:pyx import sys
:pyx print(sys.version)
</pre><span id="g_t_003apyxfile"></span><span id="python_005fx_002dspecial_002dcomments"></span><span id="index-_003apyxfile"></span>
<span id="index-python_005fx_002dspecial_002dcomments"></span>
<p>&lsquo;<code>:pyxfile</code>&lsquo; コマンドは &lsquo;<code>:pyfile</code>&lsquo; と同樣に機能します。しかし、Vim が &lsquo;<code>:pyfile</code>&lsquo; または &lsquo;<code>:py3file</code>&lsquo; を使ふやうに强制したい場合は以下のコメントのうち 1 つを追加することができます:
</p><pre class="verbatim">#!/any string/python2         &quot; Shebang。ファイルの先頭でなければならない。
#!/any string/python3         &quot; Shebang。ファイルの先頭でなければならない。
# requires python 2.x         &quot; 最大行數は '@option{modelines}' に依存。
# requires python 3.x         &quot; 最大行數は '@option{modelines}' に依存。
</pre><p>通常のモードラインとは異なり、ファイルの末尾はチェックされません。いづれのコメントも見つからない場合は、&rsquo;<samp>pyxversion</samp>&rsquo; の設定が使はれます。
<span id="W20"></span><span id="W21"></span><span id="index-W20"></span>
<span id="index-W21"></span>
もし Vim が指定された Python のバージョンをサポートしない場合、靜かなメッセージが表示されます。それらを讀むには &lsquo;<code>:messages</code>&lsquo; を使用してください。
</p>
<span id="g_t_003apyxdo"></span><span id="index-_003apyxdo"></span>
<p>&lsquo;<code>:pyxdo</code>&lsquo; コマンドは &lsquo;<code>:pydo</code>&lsquo; と同樣に機能します。
</p>
<span id="has_002dpythonx"></span><span id="index-has_002dpythonx"></span>
<p>pyx* コマンドが使用できるかどうかを調べるには以下が使へます:
</p><pre class="verbatim">if has('pythonx')
  echo 'pyx* commands are available. (Python ' . &amp;pyx . ')'
endif
</pre>
<p>|<a href="various_002etxt.html#g_t_002bpython">+python</a>| または |<a href="various_002etxt.html#g_t_002bpython3">+python3</a>| のどちらか一方のみでコンパイルされてゐる場合は、has() は 1 を返します。
</p>
<p>|<a href="various_002etxt.html#g_t_002bpython">+python</a>| と |<a href="various_002etxt.html#g_t_002bpython3">+python3</a>| の兩方でコンパイルされてゐる場合は、テストは &rsquo;<samp>pyxversion</samp>&rsquo; の設定に依存します。
</p>
<p>もし &rsquo;<samp>pyxversion</samp>&rsquo; が 0 ならば最初に Python 3 がテストされ、使用可能でなければ Python 2 がテストされます。
</p>
<p>もし &rsquo;<samp>pyxversion</samp>&rsquo; が 2 または 3 であれば、Python 2 または 3 のそれぞれどちらか一方のみをテストします。
</p>
<blockquote>
<p><strong>Note:</strong> <br>
&lsquo;has(&rsquo;pythonx&rsquo;)&lsquo; が動作するために、Python 3 または 2 を動的にロードしようとすることがある點に注意してください。これは特に Vim が 2 つのうち 1 つしかロードできない場合に副作用があります。
</p></blockquote>

<p>もしもユーザーが Python 2 を優先し、Python 3 にフォールバックしたい場合は、|<a href="starting_002etxt.html#g_t_002evimrc">.vimrc</a>| で &rsquo;<samp>pyxversion</samp>&rsquo; を明示的に設定する必要があります。例:
</p><pre class="verbatim">if has('python')
  set pyx=2
elseif has('python3')
  set pyx=3
endif
</pre>
<span id="python_002dbuilding"></span><span id="index-python_002dbuilding"></span>
<span id="g_t12_002e-Python-Dui-Ying-Fu-kidebirudosuru"></span><h3 class="section">12. Python 對應付きでビルドする</h3>

<p>Python 2 または 3 對應付きでビルドするためのいくつかのヒントがあります。
</p>
<span id="UNIX-2"></span><h4 class="unnumberedsubsec">UNIX</h4>

<p>Python インターフェイスを有效にする方法は src/Makefile を參照してください。
</p>
<p>Ubuntu では Python 2 用にこれらのパッケージをインストールする必要があるでせう:
</p><pre class="verbatim">python
python-dev
</pre><p>Python 3 用は:
</p><pre class="verbatim">python3
python3-dev
</pre><p>Python 3.6 用は:
</p><pre class="verbatim">python3.6
python3.6-dev
</pre>
<p>もしも複數のバージョンの Python 3 がある場合は、configure を實行する前に python3 を望みのバージョンにリンクする必要があります。
</p>
<hr>
<div class="header">
<p>
Up: <a href="Mu-Ci-.html" accesskey="u" rel="up">目次</a> &nbsp; [<a href="Indexes-CP.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
