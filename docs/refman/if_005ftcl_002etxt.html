<!DOCTYPE html>
<html lang="ja">
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>

<title>if_tcl.txt (Vim Reference Manual)</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<meta name="description" content="if_tcl.txt (Vim Reference Manual)">
<meta name="keywords" content="if_tcl.txt (Vim Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<link href="Mu-Ci-.html" rel="start" title="目次">
<link href="Indexes-CP.html" rel="index" title="Indexes CP">
<link href="Mu-Ci-.html" rel="up" title="目次">
<link href="if_005fole_002etxt.html" rel="next" title="if_ole.txt">
<link href="if_005fpyth_002etxt.html" rel="prev" title="if_pyth.txt">
<style>
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="style.css">


</head>

<body lang="ja">
<span id="if_005ftcl_002etxt"></span><div class="header">
<p>
Up: <a href="Mu-Ci-.html" accesskey="u" rel="up">目次</a> &nbsp; [<a href="Indexes-CP.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Tcl-intahueisu"></span><h2 class="unnumbered">Tcl インターフェイス</h2>
<pre class="verbatim">*if_tcl.txt*    For Vim バージョン 8.1.  Last change: 2019 Jul 21


                  VIMリファレンスマニュアル    by Ingo Wilken
</pre>

<span id="tcl"></span><span id="Tcl"></span><span id="TCL"></span><span id="index-tcl"></span>
<span id="index-Tcl"></span>
<span id="index-TCL"></span>
<p>Vim への Tcl インターフェイス
</p>
<table>
<tr><td width="50%">1. コマンド</td><td width="50%">|<a href="#tcl_002dex_002dcommands">tcl-ex-commands</a>|</td></tr>
<tr><td width="50%">2. Tcl コマンド</td><td width="50%">|<a href="#tcl_002dcommands">tcl-commands</a>|</td></tr>
<tr><td width="50%">3. Tcl 變數</td><td width="50%">|<a href="#tcl_002dvariables">tcl-variables</a>|</td></tr>
<tr><td width="50%">4. Tcl ウィンドウコマンド</td><td width="50%">|<a href="#tcl_002dwindow_002dcmds">tcl-window-cmds</a>|</td></tr>
<tr><td width="50%">5. Tcl バッファコマンド</td><td width="50%">|<a href="#tcl_002dbuffer_002dcmds">tcl-buffer-cmds</a>|</td></tr>
<tr><td width="50%">6. その他; Tcl からの出力</td><td width="50%">|<a href="#tcl_002dmisc">tcl-misc</a>| |<a href="#tcl_002doutput">tcl-output</a>|</td></tr>
<tr><td width="50%">7. 既知のバグと問題點</td><td width="50%">|<a href="#tcl_002dbugs">tcl-bugs</a>|</td></tr>
<tr><td width="50%">8. 例</td><td width="50%">|<a href="#tcl_002dexamples">tcl-examples</a>|</td></tr>
<tr><td width="50%">9. 動的ローディング</td><td width="50%">|<a href="#tcl_002ddynamic">tcl-dynamic</a>|</td></tr>
</table>


<span id="E280"></span><span id="index-E280"></span>
<p>{Vimが |<a href="various_002etxt.html#g_t_002btcl">+tcl</a>| 機能付きでコンパイルされてゐる場合にのみ利用できる}
</p>
<blockquote>
<p><strong>警告:</strong> <br>
多分まだいくらかのバグが殘つてゐる。バグレポート、コメント、意見などがあつたら、&lt;Ingo.Wilken@informatik.uni-oldenburg.de&gt;まで送つてください。
</p></blockquote>

<span id="tcl_002dex_002dcommands"></span><span id="E571"></span><span id="E572"></span><span id="index-tcl_002dex_002dcommands"></span>
<span id="index-E571"></span>
<span id="index-E572"></span>
<span id="g_t1_002e-komando-3"></span><h3 class="section">1. コマンド</h3>

<dl compact="compact">
<dd><span id="g_t_003atcl"></span><span id="g_t_003atc"></span><span id="index-_003atcl"></span>
<span id="index-_003atc"></span>
</dd>
<dt>:tc[l] {cmd}</dt>
<dd><p>Tcl コマンド {cmd} を實行する。&lsquo;<code>:tcl</code>&lsquo; コマンドが機能するか簡單にチェックするには:
</p><pre class="verbatim">:tcl puts &quot;Hello&quot;
</pre>
</dd>
<dt>:[range]tc[l] &lt;&lt; [endmarker]</dt>
<dt>{script}</dt>
<dt>{endmarker}</dt>
<dd><p>Tcl スクリプト {script} を實行する。
</p><blockquote>
<p><strong>Note:</strong> <br>
このコマンドは Tcl の機能付きでコンパイルされてゐないと使へない。エラーを抑制するには |<a href="if_005fperl_002etxt.html#script_002dhere">script-here</a>| を參照のこと。
</p></blockquote>
</dd>
</dl>

<p>{script} 後の {endmarker} の前には空白を置いてはいけない。
</p>
<p>&quot;&lt;&lt;&quot; の後に [endmarker] が省略されたときは |<a href="insert_002etxt.html#g_t_003aappend">:append</a>| や |<a href="insert_002etxt.html#g_t_003ainsert">:insert</a>| のやうに &rsquo;.&rsquo; が使はれる。
</p>
<p>この形式の |<a href="#g_t_003atcl">:tcl</a>| コマンドは Vim script の中に tcl コードを埋め込むのに特に便利である。
</p>
<p>例:
</p><pre class="verbatim">function! DefineDate()
    tcl &lt;&lt; EOF
    proc date {} {
        return [clock format [clock seconds]]
    }
EOF
endfunction
</pre><p>使つてゐる Tcl のバージョンを見るには:
</p><pre class="verbatim">:tcl puts [info patchlevel]
</pre>
<dl compact="compact">
<dd><span id="g_t_003atcldo"></span><span id="g_t_003atcld"></span><span id="index-_003atcldo"></span>
<span id="index-_003atcld"></span>
</dd>
<dt>:[range]tcld[o] {cmd}</dt>
<dd><p>Tcl コマンド {cmd} を、[range] 內の各行に對し、變數 &quot;line&quot; に各行のテキストを順にセットし、變數 &quot;lnum&quot; に各行番號をセットしながら實行する。&quot;line&quot; への設定はテキストを變更しするが、このコマンドの實行中に、行を追加したり削除したりすることはできない。{cmd} がエラーを返せば、コマンドは中斷される。[range] の標準値はファイルの全て &quot;1,$&quot; である。|<a href="#tcl_002dvar_002dline">tcl-var-line</a>|, |<a href="#tcl_002dvar_002dlnum">tcl-var-lnum</a>| を參照せよ。
</p>
<span id="g_t_003atclfile"></span><span id="g_t_003atclf"></span><span id="index-_003atclfile"></span>
<span id="index-_003atclf"></span>
</dd>
<dt>:tclf[ile] {file}</dt>
<dd><p>{file} 內の Tcl スクリプトを實行する。これは、&quot;<code>:tcl source {file}</code>&quot; と同じであるが、ファイル名の補完が有效である。
</p></dd>
</dl>


<blockquote>
<p><strong>Note:</strong> <br>
Tcl オブジェクト (變數のやうなもの) は、Tcl シェル內でと同樣、1 つのコマンドから次のコマンドへと引き繼がれることに注意せよ。
</p></blockquote>

<p>|<a href="eval_002etxt.html#sandbox">sandbox</a>| の中では Tcl コマンドは實行できない。
</p>
<span id="tcl_002dcommands"></span><span id="index-tcl_002dcommands"></span>
<span id="g_t2_002e-Tcl-komando"></span><h3 class="section">2. Tcl コマンド</h3>

<p>Tcl コードからは、&quot;::vim&quot; 名前空閒のコマンドを介して vim の全てにアクセスできる。次のコマンドが實裝されてゐる:
</p>
<table>
<tr><td width="60%">::vim::beep</td><td width="40%">文字通りの beep。</td></tr>
<tr><td width="60%">::vim::buffer {n}</td><td width="40%">Tcl コマンドを 1 つのバッファに作る。</td></tr>
<tr><td width="60%">::vim::buffer list</td><td width="40%">Tcl コマンドを全てのバッファに作る。</td></tr>
<tr><td width="60%">::vim::command [-quiet] {cmd}</td><td width="40%">ex コマンドを實行する。</td></tr>
<tr><td width="60%">::vim::expr {expr}</td><td width="40%">Vim の式評價を使用する。</td></tr>
<tr><td width="60%">::vim::option {opt}</td><td width="40%">vim のオプションを得る。</td></tr>
<tr><td width="60%">::vim::option {opt} {val}</td><td width="40%">vim のオプションを設定する。</td></tr>
<tr><td width="60%">::vim::window list</td><td width="40%">全てのウィンドウに Tcl コマンドを作る。</td></tr>
</table>

<span id="komando_003a-2"></span><h4 class="unnumberedsubsec">コマンド:</h4>
<dl compact="compact">
<dd><span id="tcl_002dbeep"></span><span id="index-tcl_002dbeep"></span>
</dd>
<dt>::vim::beep</dt>
<dd><p>音を鳴らす。戾り値はない。
</p>
<span id="tcl_002dbuffer"></span><span id="index-tcl_002dbuffer"></span>
</dd>
<dt>::vim::buffer {n}</dt>
<dt>::vim::buffer exists {n}</dt>
<dt>::vim::buffer list</dt>
<dd><p>vim バッファへのアクセスを提供する。整數引數を伴ひ、その數に對應するバッファへのバッファコマンド (|<a href="#tcl_002dbuffer_002dcmds">tcl-buffer-cmds</a>| を參照) を作り、結果としてそのバッファの名前を返す。不正なバッファ番號は、標準 Tcl エラーを返す。有效なバッファ番號を調べるには、vim の內部函數を使ふとよい:
</p><pre class="verbatim">set nbufs [::vim::expr bufnr(&quot;$&quot;)]
set isvalid [::vim::expr &quot;bufexists($n)&quot;]
</pre><p>&quot;list&quot; オプションは、各有效バッファに對してバッファコマンドを作り、戾り値としてコマンドバッファの名前のリストを返す。
</p>
<p>例:
</p><pre class="verbatim">set bufs [::vim::buffer list]
foreach b $bufs { $b append end &quot;The End!&quot; }
</pre><p>&quot;exists&quot; オプションは、與へられた番號のバッファが存在するかを確かめる。
</p>
<p>例:
</p><pre class="verbatim">if { [::vim::buffer exists $n] } { ::vim::command &quot;:e #$n&quot; }
</pre><p>このコマンドは、將來のバージョンで變數に置き換へられるはずである。現在のバッファについては |<a href="#tcl_002dvar_002dcurrent">tcl-var-current</a>| も參照。
</p>
<span id="tcl_002dcommand"></span><span id="index-tcl_002dcommand"></span>
</dd>
<dt>::vim::command {cmd}</dt>
<dt>::vim::command -quiet {cmd}</dt>
<dd><p>vim の (ex モードの) コマンド {cmd} を實行する。バッファ、ウィンドウに影響する ex コマンドは、全て現在のバッファ/ウィンドウを對象とする。標準 Tcl エラーコード以外の戾り値を返すことはない。このコマンドの終了後、&quot;::vim::current&quot; 變數は更新される。&quot;-quiet&quot; フラグは、vim からの全てのエラーメッセージを抑制する。
</p>
<p>例:
</p><pre class="verbatim">::vim::command &quot;set ts=8&quot;
::vim::command &quot;%s/foo/bar/g&quot;
</pre><p>ノーマルモードのコマンドの實行には、&quot;normal&quot; を使ふ (|<a href="various_002etxt.html#g_t_003anormal">:normal</a>| を參照):
</p><pre class="verbatim">set cmd &quot;jj&quot;
::vim::command &quot;normal $cmd&quot;
</pre><p>|<a href="#tcl_002dwindow_002dcommand">tcl-window-command</a>| と |<a href="#tcl_002dbuffer_002dcommand">tcl-buffer-command</a>| も參照。
</p>
<span id="tcl_002dexpr"></span><span id="index-tcl_002dexpr"></span>
</dd>
<dt>::vim::expr {expr}</dt>
<dd><p>式 {expr} を、vim の內部式評價 (|<a href="eval_002etxt.html#expression">expression</a>| を參照) を使つて評價する。バッファやウィンドウプロパティに問ひ合はせする種類の式は、全て現在のバッファ/ウィンドウを對象とする。結果を文字列として返す。リスト |<a href="eval_002etxt.html#List">List</a>| は文字列に變換される。そのとき各要素の閒に改行が插入され、連結される。
</p>
<p>例:
</p><pre class="verbatim">set perl_available [::vim::expr has(&quot;perl&quot;)]
</pre><p>|<a href="#tcl_002dwindow_002dexpr">tcl-window-expr</a>| と |<a href="#tcl_002dbuffer_002dexpr">tcl-buffer-expr</a>| も參照。
</p>
<span id="tcl_002doption"></span><span id="index-tcl_002doption"></span>
</dd>
<dt>::vim::option {opt}</dt>
<dt>::vim::option {opt} {value}</dt>
<dd><p>第 2 引數なしで、vim オプションの値を問ひ合はせる。この引數を伴へば、vim オプションに {value} を設定し、以前の値を結果として返す。&rsquo;バッファに固有&rsquo;、&rsquo;ウィンドウに固有&rsquo; と記されてゐるオプションは、全て現在のバッファ/ウィンドウを對象とする。&quot;<code>:set</code>&quot; コマンドでそれらを變更してもグローバルのオプションは變更されない。眞僞値のオプションでは、{value} は &quot;0&quot; か &quot;1&quot;、あるいは &quot;on&quot;、&quot;off&quot;、&quot;toggle&quot; のキーワードの內のどれかでなくてはならない。オプションの一覽は、|<a href="options_002etxt.html#option_002dsummary">option-summary</a>| を參照。
</p>
<p>例:
</p><pre class="verbatim">::vim::option ts 8
</pre><p>|<a href="#tcl_002dwindow_002doption">tcl-window-option</a>| と |<a href="#tcl_002dbuffer_002doption">tcl-buffer-option</a>| も參照。
</p>
<span id="tcl_002dwindow"></span><span id="index-tcl_002dwindow"></span>
</dd>
<dt>::vim::window {option}</dt>
<dd><p>vim ウィンドウへのアクセスを提供する。今のところ、&quot;list&quot; オプションのみが實裝されてゐる。これは各ウィンドウに對し、ウィンドウコマンドを作り (|<a href="#tcl_002dwindow_002dcmds">tcl-window-cmds</a>| を參照)、戾り値としてコマンドの名前のリストを返す。
</p>
<p>例:
</p><pre class="verbatim">set wins [::vim::window list]
foreach w $wins { $w height 4 }
</pre><p>このコマンドは、將來のバージョンで變數と置き換へられるはずである。現在のウィンドウについては、|<a href="#tcl_002dvar_002dcurrent">tcl-var-current</a>| を參照。
</p></dd>
</dl>

<span id="tcl_002dvariables"></span><span id="index-tcl_002dvariables"></span>
<span id="g_t3_002e-Tcl-Bian-Shu-"></span><h3 class="section">3. Tcl 變數</h3>

<p>::vim 名前空閒は、いくつかの變數を持つてゐる。これらは vim に Tcl インタープリターが呼び出されたときに作られ、現在の値が設定される。
</p>
<table>
<tr><td width="30%">::vim::current</td><td width="70%">&quot;current&quot; オブジェクトを含む排列</td></tr>
<tr><td width="30%">::vim::lbase</td><td width="70%">最初の行番號</td></tr>
<tr><td width="30%">::vim::range</td><td width="70%">現在の範圍の番號を含む排列</td></tr>
<tr><td width="30%">line</td><td width="70%">文字列形式での現在の行 (:tcldo のみ)</td></tr>
<tr><td width="30%">lnum</td><td width="70%">現在の行番號 (:tcldo のみ)</td></tr>
</table>

<span id="Bian-Shu-_003a-2"></span><h4 class="unnumberedsubsec">變數:</h4>
<dl compact="compact">
<dd><span id="tcl_002dvar_002dcurrent"></span><span id="index-tcl_002dvar_002dcurrent"></span>
</dd>
<dt>::vim::current</dt>
<dd><p>これは、vim から利用可能な樣々な &quot;current&quot; オブジェクトへのアクセスを提供する排列である。この排列の內容は、vim の現在の設定を變更 (例、カレントバッファの削除など) する可能性のある、&quot;::vim::command&quot; が呼び出された後に更新される。
</p>
<p>&quot;buffer&quot; 要素は、カレントバッファへのバッファコマンドの名前を持つ。これで、直接バッファコマンドを利用することができる (|<a href="#tcl_002dbuffer_002dcmds">tcl-buffer-cmds</a>| を參照)。この要素は讀取り專用である。
</p>
<p>例:
</p><pre class="verbatim">$::vim::current(buffer) insert begin &quot;Hello world&quot;
</pre>
<p>&quot;window&quot; 要素は、カレントウィンドウへのウィンドウコマンドの名前を持つ。これで、直接ウィンドウコマンドを利用することができる (|<a href="#tcl_002dwindow_002dcmds">tcl-window-cmds</a>| を參照)。この要素は讀取り專用である。
</p>
<p>例:
</p><pre class="verbatim">$::vim::current(window) height 10
</pre><span id="tcl_002dvar_002dlbase"></span><span id="index-tcl_002dvar_002dlbase"></span>
</dd>
<dt>::vim::lbase</dt>
<dd><p>この變數は、Tcl が行番號をどのやうに扱ふかを制禦する。
</p>
<p>これが &rsquo;1&rsquo; にセットされてゐると、行と縱列は 1 から始まる。このとき、Tcl コマンドからの行番號と vim の表現は互換性を持つ。
</p>
<p>この變數が &rsquo;0&rsquo; にセットされた場合、Tcl では行番號、縱列は 0 から始まる。これは、バッファを Tcl のリスト、行を Tcl の文字列として扱ひ、さらにインデックスを返す標準の Tcl コマンド (例へば、&quot;lsort&quot; や &quot;string first&quot;) を使ふときに役に立つ。
</p>
<p>標準値は &rsquo;1&rsquo; である。今のところ、非 0 の値は全て &rsquo;1&rsquo; として扱はれるが、この事實に依存したスクリプトを書くべきではない。|<a href="#tcl_002dlinenumbers">tcl-linenumbers</a>| も參照。
</p>
<span id="tcl_002dvar_002drange"></span><span id="index-tcl_002dvar_002drange"></span>
</dd>
<dt>::vim::range</dt>
<dd><p>これは 3 つの要素、&quot;start&quot;, &quot;begin&quot;, &quot;end&quot; から成る排列である。現在の範圍の、最初と最後の行番號を持つ。&quot;begin&quot; は &quot;start&quot; と同じである。この變數は讀取り專用である。|<a href="#tcl_002dexamples">tcl-examples</a>| を參照。
</p>
<span id="tcl_002dvar_002dline"></span><span id="index-tcl_002dvar_002dline"></span>
</dd>
<dt>line</dt>
<dd><span id="tcl_002dvar_002dlnum"></span><span id="index-tcl_002dvar_002dlnum"></span>
</dd>
<dt>lnum</dt>
<dd><p>このグローバル變數は、ex コマンド &quot;<code>:tcldo</code>&quot; が實行されたときのみ利用可能である。これらはテキストと現在の行の行番號を持つ。
</p>
<p>Tcl コマンドが &quot;<code>:tcldo</code>&quot; により呼び出されて完了したとき、&quot;line&quot; 變數が Tcl コマンドによつて設定解除されてゐないければ、現在の行は &quot;line&quot; 變數の內容に設定される。&quot;lnum&quot; 變數は讀取り專用である。
</p>
<p>これらの變數は、&quot;::vim&quot; 名前空閒に屬してゐないため、修飾なしで &quot;:tcldo&quot; で使ふことができる (これは將來のバージョンで變更されるはずである)。|<a href="#tcl_002dlinenumbers">tcl-linenumbers</a>| も參照。
</p></dd>
</dl>

<span id="tcl_002dwindow_002dcmds"></span><span id="index-tcl_002dwindow_002dcmds"></span>
<span id="g_t4_002e-Tcl-uindoukomando"></span><h3 class="section">4. Tcl ウィンドウコマンド</h3>

<p>ウィンドウコマンドは、vim のウィンドウの表現である。これらはいくつかの方法で作られる:
</p><ul>
<li> ::vim::window リスト |<a href="#tcl_002dwindow">tcl-window</a>|
</li><li> バッファコマンドの &quot;windows&quot; オプション |<a href="#tcl_002dbuffer_002dwindows">tcl-buffer-windows</a>|
</li></ul>
<p>::vim::current(window) 變數は、現在のウィンドウのウィンドウコマンドの名前を持つ。ウィンドウコマンドは、vim ウィンドウが閉ぢられるに從つて、自動的に破毀される。
</p>
<p>ウィンドウコマンドの名前が Tcl 變數 &quot;win&quot; に格納される、すなはち、&quot;$win&quot; がコマンドを呼び出す、と假定しよう。次のオプションが利用可能である:
</p>
<table>
<tr><td width="50%">$win buffer</td><td width="50%">ウィンドウのバッファのTclコマンドを作る。</td></tr>
<tr><td width="50%">$win command {cmd}</td><td width="50%">ウィンドウのコンキクストに、ex コマンドを實行する。</td></tr>
<tr><td width="50%">$win cursor</td><td width="50%">現在のカーソルの位置を得る。</td></tr>
<tr><td width="50%">$win cursor {var}</td><td width="50%">排列變數により、カーソルの位置を設定する。</td></tr>
<tr><td width="50%">$win cursor {row} {col}</td><td width="50%">カーソルの位置を設定する。</td></tr>
<tr><td width="50%">$win delcmd {cmd}</td><td width="50%">ウィンドウが閉ぢたら、Tcl コマンドを呼出す。</td></tr>
<tr><td width="50%">$win expr {expr}</td><td width="50%">ウィンドウのコンキクストに、vim の式評價を行ふ。</td></tr>
<tr><td width="50%">$win height</td><td width="50%">ウィンドウの高さを報告する。</td></tr>
<tr><td width="50%">$win height {n}</td><td width="50%">ウィンドウの高さを設定する。</td></tr>
<tr><td width="50%">$win option {opt} [val]</td><td width="50%">ウィンドウのコンテキストに、vim のオプションを取得/設定する</td></tr>
</table>

<span id="opusiyon_003a-5"></span><h4 class="unnumberedsubsec">オプション:</h4>
<dl compact="compact">
<dd><span id="tcl_002dwindow_002dbuffer"></span><span id="index-tcl_002dwindow_002dbuffer"></span>
</dd>
<dt>$win buffer</dt>
<dd><p>ウィンドウのバッファの Tcl コマンドを作成し、戾り値としてその名前を返す。名前は變數に格納されるべきである:
</p><pre class="verbatim">set buf [$win buffer]
</pre><p>$buf は有效な Tcl コマンドとなる。利用可能なオプションについては、|<a href="#tcl_002dbuffer_002dcmds">tcl-buffer-cmds</a>| を參照。
</p>
<span id="tcl_002dwindow_002dcursor"></span><span id="index-tcl_002dwindow_002dcursor"></span>
</dd>
<dt>$win cursor</dt>
<dt>$win cursor {var}</dt>
<dt>$win cursor {row} {col}</dt>
<dd><p>引數なしで、現在のカーソル位置を文字列として返す。これは、Tcl の排列變數へと變換することができる:
</p><pre class="verbatim">array set here [$win cursor]
</pre><p>このとき、&quot;here(row)&quot; と &quot;here(column)&quot; がカーソル位置を持つ。1 つの引數を伴ふと、引數は 2 つの要素 &quot;row&quot; と &quot;column&quot; を持つべき、Tcl 排列變數名と解釋される。これらはカーソルを新しい位置へセットするために使はれる。
</p><pre class="verbatim">$win cursor here	;# not $here !
</pre><p>2 つの引數を伴ひ、カーソルを row と colum で指定した位置へセットする:
</p><pre class="verbatim">$win cursor $here(row) $here(column)
</pre><p>不正な位置指定は、&quot;catch&quot; にて捕捉可能な標準 Tcl エラーを返す。row と column の値は、&quot;::vim::lbase&quot; 變數に依存する。|<a href="#tcl_002dvar_002dlbase">tcl-var-lbase</a>| を參照。
</p>
<span id="tcl_002dwindow_002ddelcmd"></span><span id="index-tcl_002dwindow_002ddelcmd"></span>
</dd>
<dt>$win delcmd {cmd}</dt>
<dd><p>Tcl コマンド {cmd} を、ウィンドウ破毀のコールバックとして登錄する。このコマンドはウィンドウが閉ぢられた直後に (グローバルスコープで) 實行される。複雜なコマンドは、&quot;list&quot; により構成するとよい:
</p><pre class="verbatim">$win delcmd [list puts vimerr &quot;window deleted&quot;]
</pre><p>|<a href="#tcl_002dbuffer_002ddelcmd">tcl-buffer-delcmd</a>| を參照。
</p>
<span id="tcl_002dwindow_002dheight"></span><span id="index-tcl_002dwindow_002dheight"></span>
</dd>
<dt>$win height</dt>
<dt>$win height {n}</dt>
<dd><p>引數なしで、ウィンドウの現在の高さを報告する。引數を伴ふと、ウィンドウの高さを {n} に設定しようと試み、戾り値として新しい高さ (これは {n} ではないかもしれない) を返す。
</p>
<span id="tcl_002dwindow_002dcommand"></span><span id="index-tcl_002dwindow_002dcommand"></span>
</dd>
<dt>$win command [-quiet] {cmd}</dt>
<dd><span id="tcl_002dwindow_002dexpr"></span><span id="index-tcl_002dwindow_002dexpr"></span>
</dd>
<dt>$win expr {expr}</dt>
<dd><span id="tcl_002dwindow_002doption"></span><span id="index-tcl_002dwindow_002doption"></span>
</dd>
<dt>$win option {opt} [val]</dt>
<dd><p>これらは、全てがカレントウィンドウの代はりに $win で表現されるウィンドウコンテキストにおいて實行されるといふ點を除けば、&quot;::vim::command&quot; などに似てゐる。例へば、&rsquo;local to window&rsquo; と記されたオプションの設定は、ウィンドウ $win に影響を與へる。バッファへの影響、または問ひ合はせは、全てこのウィンドウに表示されるバッファ (すなはち、&quot;$win buffer&quot; で表現されるバッファ) を對象とする。より詳しい情報は、|<a href="#tcl_002dcommand">tcl-command</a>|, |<a href="#tcl_002dexpr">tcl-expr</a>|, |<a href="#tcl_002doption">tcl-option</a>| を參照せよ。
</p>
<p>例:
</p><pre class="verbatim">$win option number on
</pre></dd>
</dl>

<span id="tcl_002dbuffer_002dcmds"></span><span id="index-tcl_002dbuffer_002dcmds"></span>
<span id="g_t5_002e-Tcl-batuhuakomando"></span><h3 class="section">5. Tcl バッファコマンド</h3>

<p>バッファコマンドは vim のバッファを表現する。これらはいくつかの方法で作成される:
</p><ul>
<li> ::vim::buffer {N} |<a href="#tcl_002dbuffer">tcl-buffer</a>|
</li><li> ::vim::buffer リスト |<a href="#tcl_002dbuffer">tcl-buffer</a>|
</li><li> ウィンドウコマンドの &quot;buffer&quot; オプション |<a href="#tcl_002dwindow_002dbuffer">tcl-window-buffer</a>|
</li></ul>
<p>::vim::current (バッファ) 變數は、カレントバッファへのバッファコマンドの名前を持つてゐる。バッファコマンドは vim のバッファが破毀されると、それに合はせて自動的に削除される。バッファの內容が變更されると、バッファ內の全てのマークは自動的に調整される。Tcl コマンドによるバッファ內容への變更は、vim の &quot;undo&quot; コマンドで元に戾すことができる (|<a href="undo_002etxt.html#undo">undo</a>| を參照)。
</p>
<p>バッファコマンドの名前が Tcl 變數 &quot;buf&quot; に格納されてゐる、すなはち、&quot;$buf&quot; がコマンドを呼出すものと假定しよう。次のオプションが利用可能である:
</p>
<table>
<tr><td width="50%">$buf append {n} {str}</td><td width="50%">バッファの行 {n} の後に、行を追加する。</td></tr>
<tr><td width="50%">$buf command {cmd}</td><td width="50%">バッファコンテキストで ex コマンドを實行する。</td></tr>
<tr><td width="50%">$buf count</td><td width="50%">バッファ內の行數を返す。</td></tr>
<tr><td width="50%">$buf delcmd {cmd}</td><td width="50%">バッファが削除されたら Tcl コマンドを呼ぶ。</td></tr>
<tr><td width="50%">$buf delete {n}</td><td width="50%">1 行を削除する。</td></tr>
<tr><td width="50%">$buf delete {n} {m}</td><td width="50%">數行を削除する。</td></tr>
<tr><td width="50%">$buf expr {expr}</td><td width="50%">バッファコンテキストで、vim の式評價をする。</td></tr>
<tr><td width="50%">$buf get {n}</td><td width="50%">1 行を文字列として取得する。</td></tr>
<tr><td width="50%">$buf get {n} {m}</td><td width="50%">數行をリストとして取得する。</td></tr>
<tr><td width="50%">$buf insert {n} {str}</td><td width="50%">バッファに行 {n} として、行を插入する。</td></tr>
<tr><td width="50%">$buf last</td><td width="50%">バッファの最終行の行番號を返す。</td></tr>
<tr><td width="50%">$buf mark {mark}</td><td width="50%">バッファマークの位置を返す。</td></tr>
<tr><td width="50%">$buf name</td><td width="50%">バッファ內のファイル名を返す。</td></tr>
<tr><td width="50%">$buf number</td><td width="50%">そのバッファの番號を返す。</td></tr>
<tr><td width="50%">$buf option {opt} [val]</td><td width="50%">バッファコンテキストで vim オプションを取得/設定。</td></tr>
<tr><td width="50%">$buf set {n} {text}</td><td width="50%">1 行を置換する。</td></tr>
<tr><td width="50%">$buf set {n} {m} {list}</td><td width="50%">數行を置換する</td></tr>
<tr><td width="50%">$buf windows</td><td width="50%">バッファウィンドウの Tcl コマンドを作成する。</td></tr>
</table>
<span id="tcl_002dlinenumbers"></span><span id="index-tcl_002dlinenumbers"></span>
<p>ほとんどのバッファコマンドは引數として行番號を取る。Tcl コマンドがこれらをどう扱ふかは &quot;::vim::lbase&quot; 變數に依つてゐる (|<a href="#tcl_002dvar_002dlbase">tcl-var-lbase</a>| を參照)。行番號の代はりに、いくつかのキーワードを使ふこともできる: &quot;top&quot;, &quot;start&quot;, &quot;begin&quot;, &quot;first&quot;, &quot;bottom&quot;, &quot;end&quot;, &quot;last&quot; が使へる。
</p>
<span id="opusiyon_003a-6"></span><h4 class="unnumberedsubsec">オプション:</h4>
<dl compact="compact">
<dd><span id="tcl_002dbuffer_002dappend"></span><span id="index-tcl_002dbuffer_002dappend"></span>
</dd>
<dt>$buf append {n} {str}</dt>
<dd><span id="tcl_002dbuffer_002dinsert"></span><span id="index-tcl_002dbuffer_002dinsert"></span>
</dd>
<dt>$buf insert {n} {str}</dt>
<dd><p>バッファに行を追加する。&quot;insert&quot; オプションを伴ふと文字列は新しい行 {n} になり、&quot;append&quot; オプションを伴ふと行 {n} の後に插入される。
</p>
<p>例:
</p><pre class="verbatim">$buf insert top &quot;ここが始まり。&quot;
$buf append end &quot;ここで終はり。&quot;
</pre><p>バッファに行にリストを追加するには、ループを使ふとよい:
</p><pre class="verbatim">foreach line $list { $buf append $num $line ; incr num }
</pre><span id="tcl_002dbuffer_002dcount"></span><span id="index-tcl_002dbuffer_002dcount"></span>
</dd>
<dt>$buf count</dt>
<dd><p>バッファ內の行の總數を返す。
</p>
<span id="tcl_002dbuffer_002ddelcmd"></span><span id="index-tcl_002dbuffer_002ddelcmd"></span>
</dd>
<dt>$buf delcmd {cmd}</dt>
<dd><p>Tcl コマンド {cmd} を、バッファの削除に對するコールバックとして登錄する。このコマンドは、バッファが削除された直後に (グローバルスコープで) 實行される。複雜なコマンドは &quot;list&quot; として構成するべきである:
</p><pre class="verbatim">$buf delcmd [list puts vimerr &quot;buffer [$buf number] gone&quot;]
</pre><p>|<a href="#tcl_002dwindow_002ddelcmd">tcl-window-delcmd</a>| も參照。
</p>
<span id="tcl_002dbuffer_002ddelete"></span><span id="index-tcl_002dbuffer_002ddelete"></span>
</dd>
<dt>$buf delete {n}</dt>
<dt>$buf delete {n} {m}</dt>
<dd><p>バッファから行 {n}、または行 {n} から {m} までを削除する。次の例は、最終行を除く全ての行を削除する:
</p><pre class="verbatim">$buf delete first [expr [$buf last] - 1]
</pre><span id="tcl_002dbuffer_002dget"></span><span id="index-tcl_002dbuffer_002dget"></span>
</dd>
<dt>$buf get {n}</dt>
<dt>$buf get {n} {m}</dt>
<dd><p>バッファから 1 行以上を取得する。1 行の場合、戾り値は文字列である; 數行の場合には文字列のリストが返される。
</p>
<p>例:
</p><pre class="verbatim">set topline [$buf get top]
</pre><span id="tcl_002dbuffer_002dlast"></span><span id="index-tcl_002dbuffer_002dlast"></span>
</dd>
<dt>$buf last</dt>
<dd><p>最終行の行番號を返す。この値は &quot;::vim::lbase&quot; 變數に依存する。|<a href="#tcl_002dvar_002dlbase">tcl-var-lbase</a>| を參照。
</p>
<span id="tcl_002dbuffer_002dmark"></span><span id="index-tcl_002dbuffer_002dmark"></span>
</dd>
<dt>$buf mark {mark}</dt>
<dd><p>名前付きマークの位置を、ウィンドウコマンドの &quot;cursor&quot; オプションにて表されるカーソル位置に似た文字列として返す (|<a href="#tcl_002dwindow_002dcursor">tcl-window-cursor</a>| を參照)。これは Tcl 排列變數に變換される:
</p><pre class="verbatim">array set mpos [$buf mark &quot;a&quot;]
</pre><p>&quot;mpos(column)&quot; と &quot;mpos(row)&quot; はマークの位置を保持する。マークがセットされてゐなければ、標準 Tcl エラーが返される。
</p>
</dd>
<dt>$buf name</dt>
<dd><p>バッファ內のファイル名を返す。ファイルなしのバッファの場合、空文字列を返す。
</p>
</dd>
<dt>$buf number</dt>
<dd><p>そのバッファの番號を返す。|<a href="windows_002etxt.html#g_t_003abuffer">:buffer</a>| を參照。この例は、vim からバッファを削除する:
</p><pre class="verbatim">::vim::command &quot;bdelete [$buf number]&quot;
</pre><span id="tcl_002dbuffer_002dset"></span><span id="index-tcl_002dbuffer_002dset"></span>
</dd>
<dt>$buf set {n} {string}</dt>
<dt>$buf set {n} {m} {list}</dt>
<dd><p>バッファ內の 1 行以上を置換する。リスト (list) が置換される行以上の要素を持つてゐた場合、それらはバッファに追加される。リストの要素が少ない場合には、置換されなかつた行はバッファから削除される。
</p>
<span id="tcl_002dbuffer_002dwindows"></span><span id="index-tcl_002dbuffer_002dwindows"></span>
</dd>
<dt>$buf windows</dt>
<dd><p>そのバッファに表示されてゐる各ウィンドウに對し、ウィンドウコマンドを作成し、コマンド名のリストを結果として返す。
</p>
<p>例:
</p><pre class="verbatim">set winlist [$buf windows]
foreach win $winlist { $win height 4 }
</pre><p>可能なオプションについては |<a href="#tcl_002dwindow_002dcmds">tcl-window-cmds</a>| を參照。
</p>
<span id="tcl_002dbuffer_002dcommand"></span><span id="index-tcl_002dbuffer_002dcommand"></span>
</dd>
<dt>$buf command [-quiet] {cmd}</dt>
<dd><span id="tcl_002dbuffer_002dexpr"></span><span id="index-tcl_002dbuffer_002dexpr"></span>
</dd>
<dt>$buf expr {expr}</dt>
<dd><span id="tcl_002dbuffer_002doption"></span><span id="index-tcl_002dbuffer_002doption"></span>
</dd>
<dt>$buf option {opt} [val]</dt>
<dd><p>これらは、カレントバッファではなく、$buf で表されるバッファコンテキストにおいて全てが實行されるといふこと以外は、&quot;::vim::command&quot; などと同じである。
</p>
<p>例へば、&rsquo;local to buffer&rsquo; と記されたオプションの設定は、バッファ $buf に作用する。ウィンドウへの作用、あるいは問ひ合はせは、全て vim のウィンドウリストの內でこのバッファを表示してゐる最初のウィンドウ (すなはち、&quot;$buf windows&quot; で最初に返されるエントリ) に對して行はれる。
</p>
<p>より詳しい情報は |<a href="#tcl_002dcommand">tcl-command</a>|, |<a href="#tcl_002dexpr">tcl-expr</a>|, |<a href="#tcl_002doption">tcl-option</a>| を參照。
</p>
<p>例:
</p><pre class="verbatim">if { [$buf option modified] } { $buf command &quot;w&quot; }
</pre></dd>
</dl>

<span id="tcl_002dmisc"></span><span id="tcl_002doutput"></span><span id="index-tcl_002dmisc"></span>
<span id="index-tcl_002doutput"></span>
<span id="g_t6_002e-sonoTa-_003b-Tcl-karanoChu-Li-"></span><h3 class="section">6. その他; Tcl からの出力</h3>

<p>標準 Tcl コマンド &quot;exit&quot; と &quot;catch&quot; は、カスタムバージョンのものと置き換へられてゐる。&quot;exit&quot; は、現在の Tcl スクリプトを終了して vim に戾り、Tcl インタープリターを破毀する。その後、&quot;:tcl&quot; が呼出されたときに、新しい Tcl インタープリターが作成される。&quot;exit&quot; は、vim を終了させることはない！
</p>
<p>&quot;catch&quot; は、&quot;exit&quot; でのスクリプトの終了を妨げることがない點を除けば、標準のものと同じである。終了コードが 0 でないとき (exit code != 0)、Tcl スクリプトを呼出した ex コマンドはエラーを返す。
</p>
<p>2 つの新しい I/O ストリーム、&quot;vimout&quot;, &quot;vimerr&quot; が Tcl から利用可能である。これらに向けられた全ての出力は、それぞれ vim の情報メッセージとエラーメッセージとして、メッセージエリアに表示される。標準 Tcl 出力ストリーム stdout と stderr は、普通の &quot;puts&quot; コマンドで vim にメッセージを表示できるやう、vimout と vimerr に割當てられる。
</p>
<span id="tcl_002dbugs"></span><span id="index-tcl_002dbugs"></span>
<span id="g_t7_002e-Ji-Zhi-nobagutoWen-Ti-Dian-"></span><h3 class="section">7. 既知のバグと問題點</h3>

<p>Tcl 內部から、(&quot;::vim::command&quot; を介して) Tcl の ex コマンドを呼出すと、豫期できない副作用を起こす可能性がある。
</p>
<p>このコマンドは、&quot;::vim::command&quot; を安全な子インタープリター內で利用可能にするため、その子インタープリターを不安定にして、標準のインタープリターと同じ能力を持つ新しいインタープリターを作る。(ネストされた :tcl* 呼び出しをブロックしたり、安全なインタープリターから新しい安全なインタープリターのみを呼出すやう保證することは簡單なことだが、それは不適切である - vim の設定により、&quot;::vim::command&quot; は他の多くのスクリプト言語の任意のコードを實行することができるからである。)
</p>
<p>この新しいインタープリター內での &quot;exit&quot; 呼出しは、古いインタープリターには影響しない; 新しいインタープリターのみを終了し、スクリプト處理は古いインタープリターで正常に續けられる。
</p>
<p>stdin からの入力は、今のところサポートされてゐない。
</p>
<span id="tcl_002dexamples"></span><span id="index-tcl_002dexamples"></span>
<span id="g_t8_002e-Li_003a"></span><h3 class="section">8. 例:</h3>

<p>いくつかの小さな (そして、たぶん役に立つ) Tcl スクリプトを紹介しよう。
</p>
<p>このスクリプトはバッファ全體の行をソートする (名前のリストとか、そのやうなものであると假定する):
</p><pre class="verbatim">set buf $::vim::current(buffer)
set lines [$buf get top bottom]
set lines [lsort -dictionary $lines]
$buf set top bottom $lines
</pre>
<p>このスクリプトは、バッファ內の行を反轉する。&quot;::vim::lbase&quot; と &quot;$buf last&quot; は、どんな行番號の設定でも機能することに注目。
</p><pre class="verbatim">set buf $::vim::current(buffer)
set t $::vim::lbase
set b [$buf last]
while { $t &lt; $b } {
        set tl [$buf get $t]
        set bl [$buf get $b]
        $buf set $t $bl
        $buf set $b $tl
        incr t
        incr b -1
}
</pre>
<p>このスクリプトは、現在の範圍の各行に連續した番號を付け加へる:
</p><pre class="verbatim">set buf $::vim::current(buffer)
set i $::vim::range(start)
set n 1
while { $i &lt;= $::vim::range(end) } {
        set line [$buf get $i]
        $buf set $i &quot;$n\t$line&quot;
        incr i ; incr n
}
</pre>
<p>同じことが、&quot;<code>:tcldo</code>&quot; による 2 つの ex コマンドで、より迅速に行へる:
</p><pre class="verbatim">:tcl set n 1
:[range]tcldo set line &quot;$n\t$line&quot; ; incr n
</pre>
<p>このプロシージャは、各バッファでexコマンドを走らせる (Ron Aaron 氏のアイデア):
</p><pre class="verbatim">proc eachbuf { cmd } {
        foreach b [::vim::buffer list] {
                $b command $cmd
        }
}
</pre><p>こんな風に使ふ:
</p><pre class="verbatim">:tcl eachbuf %s/foo/bar/g
</pre>
<p>Tcl の文字列とバックスラッシュの置換には氣をつけてほしい。疑はしいときは、丸括弧で ex コマンドを括つておくとよい。
</p>

<p>いくつかの Tcl コマンドをずつと vim で使ひたいといふなら、それらをファイル (例へば Unix マシンでは &quot;~/.vimrc.tcl&quot; など) に入れておき、スタートアップファイル (Unix マシンなら標準で &quot;~/.vimrc&quot;) に以下の行を付け加へる:
</p><pre class="verbatim">if has(&quot;tcl&quot;)
        tclfile ~/.vimrc.tcl
endif
</pre>
<span id="tcl_002ddynamic"></span><span id="index-tcl_002ddynamic"></span>
<span id="g_t9_002e-Dong-De-rodeingu-1"></span><h3 class="section">9. 動的ローディング</h3>

<p>MS-Windows と UNIX では Tcl ライブラリを動的に讀み込むことが可能である。これを行ふと |<a href="various_002etxt.html#g_t_003aversion">:version</a>| の出力に |<a href="various_002etxt.html#g_t_002btcl_002fdyn">+tcl/dyn</a>| が含まれるやうになる。
</p>
<p>この場合、Vim は必要なときだけ Tcl の DLL ファイルや共有ライブラリファイルを檢索する。Tcl インターフェイスを使はないときはこれらは不要なので、それらのファイルが無くても Vim を使ふことができる。
</p>

<span id="MS_002dWindows-6"></span><h4 class="unnumberedsubsec">MS-Windows</h4>

<p>Tcl インターフェイスを使ふには Tcl の DLL が檢索パス內に存在しなければならない。コンソールウィンドウで &quot;path&quot; とタイプすると、どのディレクトリが檢索パスとなるか表示することができる。また &rsquo;<samp>tcldll</samp>&rsquo; オプションを Tcl の DLL を指定するのに使ふこともできる。
</p>
<p>DLL の名前は Vim をコンパイルした時の Tcl のバージョンに一致しなければならない。現在その名前は &quot;tcl83.dll&quot; である。これは Tcl8.3 用である。これを確かめるには、&quot;gvim.exe&quot; を開き、&quot;tcl\d*.dll\c&quot; を檢索する。
</p>

<span id="Unix-6"></span><h4 class="unnumberedsubsec">Unix</h4>

<p>コンパイル時に DYNAMIC_TCL_DLL で指定されたファイルの代はりに &rsquo;<samp>tcldll</samp>&rsquo; オプションで使用する Tcl の共有ライブラリのファイルを指定するのに使へる。共有ライブラリのバージョンは Vim をコンパイルする時に用いた Tcl のバージョンと一致してゐなければならない。
</p>
<hr>
<div class="header">
<p>
Up: <a href="Mu-Ci-.html" accesskey="u" rel="up">目次</a> &nbsp; [<a href="Indexes-CP.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
